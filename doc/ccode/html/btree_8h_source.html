<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Content-Centric Networking in C: include/ccn/btree.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_41e250420098d3193238c2ec3f91d540.html">include</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_fb678123179ff8fa3164fd7f81a7d8bd.html">ccn</a>
  </div>
</div>
<div class="contents">
<h1>btree.h</h1><a href="btree_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment"> * @file ccn/btree.h</span>
<a name="l00003"></a>00003 <span class="comment"> * BTree</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 <span class="comment">/* Part of the CCNx C Library.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (C) 2011-12 Palo Alto Research Center, Inc.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This library is free software; you can redistribute it and/or modify it</span>
<a name="l00010"></a>00010 <span class="comment"> * under the terms of the GNU Lesser General Public License version 2.1</span>
<a name="l00011"></a>00011 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00012"></a>00012 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00015"></a>00015 <span class="comment"> * Lesser General Public License for more details. You should have received</span>
<a name="l00016"></a>00016 <span class="comment"> * a copy of the GNU Lesser General Public License along with this library;</span>
<a name="l00017"></a>00017 <span class="comment"> * if not, write to the Free Software Foundation, Inc., 51 Franklin Street,</span>
<a name="l00018"></a>00018 <span class="comment"> * Fifth Floor, Boston, MA 02110-1301 USA.</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020  
<a name="l00021"></a>00021 <span class="preprocessor">#ifndef CCN_BTREE_DEFINED</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#define CCN_BTREE_DEFINED</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="charbuf_8h.html" title="Expandable character buffer for counted sequences of arbitrary octets.">ccn/charbuf.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="hashtb_8h.html" title="Hash table.">ccn/hashtb.h</a>&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a>;
<a name="l00030"></a>00030 <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a>;
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">/**</span>
<a name="l00033"></a>00033 <span class="comment"> * Methods for external I/O of btree nodes.</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> * These are supplied by the client, and provide an abstraction</span>
<a name="l00036"></a>00036 <span class="comment"> * to hold the persistent representation of the btree.</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> * Each node has a nodeid that serves as its filename.  These start as 1 and</span>
<a name="l00039"></a>00039 <span class="comment"> * are assigned consecutively. The node may correspond to a file in a file</span>
<a name="l00040"></a>00040 <span class="comment"> * system, or to some other abstraction as appropriate.</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> * Open should prepare for I/O to a node.  It may use the iodata slot to</span>
<a name="l00043"></a>00043 <span class="comment"> * keep track of its state, and should set iodata to a non-NULL value.</span>
<a name="l00044"></a>00044 <span class="comment"> * It should update the count of openfds as appropriate.</span>
<a name="l00045"></a>00045 <span class="comment"> *</span>
<a name="l00046"></a>00046 <span class="comment"> * Read gets bytes from the file and places it into the buffer at the</span>
<a name="l00047"></a>00047 <span class="comment"> * corresponding position.  The parameter is a limit for the max buffer size.</span>
<a name="l00048"></a>00048 <span class="comment"> * Bytes prior to the clean mark do not need to be read.</span>
<a name="l00049"></a>00049 <span class="comment"> * The buffer should be extended, if necessary, to hold the data.</span>
<a name="l00050"></a>00050 <span class="comment"> * Read is not responsible for updating the clean mark.</span>
<a name="l00051"></a>00051 <span class="comment"> * </span>
<a name="l00052"></a>00052 <span class="comment"> * Write puts bytes from the buffer into the file, and truncates the file</span>
<a name="l00053"></a>00053 <span class="comment"> * according to the buffer length.  Bytes prior to the clean mork do not</span>
<a name="l00054"></a>00054 <span class="comment"> * need to be written, since they should be the same in the buffer and the</span>
<a name="l00055"></a>00055 <span class="comment"> * file.  Write is not responsible for updating the clean mark.</span>
<a name="l00056"></a>00056 <span class="comment"> *</span>
<a name="l00057"></a>00057 <span class="comment"> * Close is called at the obvious time.  It should free any node io state and</span>
<a name="l00058"></a>00058 <span class="comment"> * set iodata to NULL, updating openfds as appropriate.  It should not change</span>
<a name="l00059"></a>00059 <span class="comment"> * the other parts of the node.</span>
<a name="l00060"></a>00060 <span class="comment"> *</span>
<a name="l00061"></a>00061 <span class="comment"> * Negative return values indicate errors.</span>
<a name="l00062"></a>00062 <span class="comment"> */</span>
<a name="l00063"></a>00063 <span class="keyword">typedef</span> int (*<a class="code" href="btree_8h.html#a628c27764e073796aedd050177687739" title="Methods for external I/O of btree nodes.">ccn_btree_io_openfn</a>)
<a name="l00064"></a><a class="code" href="btree_8h.html#a628c27764e073796aedd050177687739">00064</a>     (<span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *, <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *);
<a name="l00065"></a>00065 <span class="keyword">typedef</span> int (*<a class="code" href="btree_8h.html#aed3cdb2c73d1e73793c29e291b448d19">ccn_btree_io_readfn</a>)
<a name="l00066"></a><a class="code" href="btree_8h.html#aed3cdb2c73d1e73793c29e291b448d19">00066</a>     (<span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *, <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *, unsigned);
<a name="l00067"></a>00067 <span class="keyword">typedef</span> int (*<a class="code" href="btree_8h.html#a6e565d97846b55ef29672b0d83746235">ccn_btree_io_writefn</a>)
<a name="l00068"></a><a class="code" href="btree_8h.html#a6e565d97846b55ef29672b0d83746235">00068</a>     (<span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *, <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *);
<a name="l00069"></a>00069 <span class="keyword">typedef</span> int (*<a class="code" href="btree_8h.html#a3ee5f6483145126788377228d5c67480">ccn_btree_io_closefn</a>)
<a name="l00070"></a><a class="code" href="btree_8h.html#a3ee5f6483145126788377228d5c67480">00070</a>     (<span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *, <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *);
<a name="l00071"></a>00071 <span class="keyword">typedef</span> int (*<a class="code" href="btree_8h.html#af88152e1fdaca4413140f345bbb931d8">ccn_btree_io_destroyfn</a>)
<a name="l00072"></a><a class="code" href="btree_8h.html#af88152e1fdaca4413140f345bbb931d8">00072</a>     (<span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> **);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">/* This serves as the external name of a btree node. */</span>
<a name="l00075"></a><a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">00075</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a>;
<a name="l00076"></a>00076 <span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">/**</span>
<a name="l00078"></a>00078 <span class="comment"> * Holds the methods and the associated common data.</span>
<a name="l00079"></a>00079 <span class="comment"> */</span>
<a name="l00080"></a><a class="code" href="structccn__btree__io.html">00080</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> {
<a name="l00081"></a><a class="code" href="structccn__btree__io.html#a2e7db640521e17cbdd20081edaf22265">00081</a>     <span class="keywordtype">char</span> <a class="code" href="structccn__btree__io.html#a2e7db640521e17cbdd20081edaf22265">clue</a>[16]; <span class="comment">/* unused except for debugging/logging */</span>
<a name="l00082"></a><a class="code" href="structccn__btree__io.html#abb3dafc2b1e4e3cc003c5cef0d374688">00082</a>     <a class="code" href="btree_8h.html#a628c27764e073796aedd050177687739" title="Methods for external I/O of btree nodes.">ccn_btree_io_openfn</a> <a class="code" href="structccn__btree__io.html#abb3dafc2b1e4e3cc003c5cef0d374688">btopen</a>;
<a name="l00083"></a><a class="code" href="structccn__btree__io.html#a0c0cb6d5381e5b8160ca5020768ef2a2">00083</a>     <a class="code" href="btree_8h.html#aed3cdb2c73d1e73793c29e291b448d19">ccn_btree_io_readfn</a> <a class="code" href="structccn__btree__io.html#a0c0cb6d5381e5b8160ca5020768ef2a2">btread</a>;
<a name="l00084"></a><a class="code" href="structccn__btree__io.html#a3471a9f346f05845c39cfebc36b51ed4">00084</a>     <a class="code" href="btree_8h.html#a6e565d97846b55ef29672b0d83746235">ccn_btree_io_writefn</a> <a class="code" href="structccn__btree__io.html#a3471a9f346f05845c39cfebc36b51ed4">btwrite</a>;
<a name="l00085"></a><a class="code" href="structccn__btree__io.html#ae7972c74a0bdccf68090ed8ba44e8500">00085</a>     <a class="code" href="btree_8h.html#a3ee5f6483145126788377228d5c67480">ccn_btree_io_closefn</a> <a class="code" href="structccn__btree__io.html#ae7972c74a0bdccf68090ed8ba44e8500">btclose</a>;
<a name="l00086"></a><a class="code" href="structccn__btree__io.html#a0e55f32b83c40baa46c2d391c2c48c5d">00086</a>     <a class="code" href="btree_8h.html#af88152e1fdaca4413140f345bbb931d8">ccn_btree_io_destroyfn</a> <a class="code" href="structccn__btree__io.html#a0e55f32b83c40baa46c2d391c2c48c5d">btdestroy</a>;
<a name="l00087"></a><a class="code" href="structccn__btree__io.html#a85b57bd8c7e0fbd284e1202e870051e7">00087</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__io.html#a85b57bd8c7e0fbd284e1202e870051e7" title="Largest assigned nodeid.">maxnodeid</a>;    <span class="comment">/**&lt; Largest assigned nodeid */</span>
<a name="l00088"></a><a class="code" href="structccn__btree__io.html#ad3d10b59f5d00284cb7f9249d22351a1">00088</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree__io.html#ad3d10b59f5d00284cb7f9249d22351a1" title="Number of open files.">openfds</a>;               <span class="comment">/**&lt; Number of open files */</span>
<a name="l00089"></a><a class="code" href="structccn__btree__io.html#a91b7f74fb340e542982dff19101582c8">00089</a>     <span class="keywordtype">void</span> *<a class="code" href="structccn__btree__io.html#a91b7f74fb340e542982dff19101582c8">data</a>;
<a name="l00090"></a>00090 };<span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">/**</span>
<a name="l00092"></a>00092 <span class="comment"> * State associated with a btree node</span>
<a name="l00093"></a>00093 <span class="comment"> *</span>
<a name="l00094"></a>00094 <span class="comment"> * These usually live in the resident hashtb of a ccn_btree, but might be</span>
<a name="l00095"></a>00095 <span class="comment"> * elsewhere (such as stack-allocated) in some cases.</span>
<a name="l00096"></a>00096 <span class="comment"> */</span>
<a name="l00097"></a><a class="code" href="structccn__btree__node.html">00097</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> {
<a name="l00098"></a><a class="code" href="structccn__btree__node.html#a62d9b233a14f2af1d5a0033b856cc849">00098</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__node.html#a62d9b233a14f2af1d5a0033b856cc849" title="Identity of node.">nodeid</a>;        <span class="comment">/**&lt; Identity of node */</span>
<a name="l00099"></a><a class="code" href="structccn__btree__node.html#af5b2da986574b1144d5d61011ab0ad77">00099</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structccn__btree__node.html#af5b2da986574b1144d5d61011ab0ad77" title="The internal buffer.">buf</a>;    <span class="comment">/**&lt; The internal buffer */</span>
<a name="l00100"></a><a class="code" href="structccn__btree__node.html#a84164184436c3af8d578e23e01263708">00100</a>     <span class="keywordtype">void</span> *<a class="code" href="structccn__btree__node.html#a84164184436c3af8d578e23e01263708" title="Private use by ccn_btree_io methods.">iodata</a>;               <span class="comment">/**&lt; Private use by ccn_btree_io methods */</span>
<a name="l00101"></a><a class="code" href="structccn__btree__node.html#a88ed2264b36bcdaca0eb0f33ac3e51a4">00101</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__node.html#a88ed2264b36bcdaca0eb0f33ac3e51a4" title="Parent node id; 0 if unknown.">parent</a>;        <span class="comment">/**&lt; Parent node id; 0 if unknown */</span>
<a name="l00102"></a><a class="code" href="structccn__btree__node.html#a5a6893b1fad8985292160273198316c1">00102</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structccn__btree__node.html#a5a6893b1fad8985292160273198316c1" title="Number of stable buffered bytes at front.">clean</a>;             <span class="comment">/**&lt; Number of stable buffered bytes at front */</span>
<a name="l00103"></a><a class="code" href="structccn__btree__node.html#a05cde4eec6f5da81f9f042965850faa8">00103</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structccn__btree__node.html#a05cde4eec6f5da81f9f042965850faa8" title="Index of first unused byte of free space.">freelow</a>;           <span class="comment">/**&lt; Index of first unused byte of free space */</span>
<a name="l00104"></a><a class="code" href="structccn__btree__node.html#a6a85ccb98cc47050b5a921810dce1027">00104</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structccn__btree__node.html#a6a85ccb98cc47050b5a921810dce1027" title="Structure is not to be trusted.">corrupt</a>;           <span class="comment">/**&lt; Structure is not to be trusted */</span>
<a name="l00105"></a><a class="code" href="structccn__btree__node.html#ac25d44b05f59eb0287c24a6d41b54096">00105</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structccn__btree__node.html#ac25d44b05f59eb0287c24a6d41b54096" title="Meters use of the node.">activity</a>;          <span class="comment">/**&lt; Meters use of the node */</span>
<a name="l00106"></a>00106 };
<a name="l00107"></a>00107 <span class="comment"></span>
<a name="l00108"></a>00108 <span class="comment">/** Increment to node-&gt;activity when node is referenced but not changed */</span>
<a name="l00109"></a><a class="code" href="btree_8h.html#ac297bf7bfe64d6b5630bbf06a121522a">00109</a> <span class="preprocessor">#define CCN_BT_ACTIVITY_REFERENCE_BUMP 1</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="comment">/** Increment to node-&gt;activity when node is read from disk */</span>
<a name="l00111"></a><a class="code" href="btree_8h.html#a50e9391b5fb45ba91f394aeba15de2a7">00111</a> <span class="preprocessor">#define CCN_BT_ACTIVITY_READ_BUMP 8</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="comment">/** Increment to node-&gt;activity when node is modified */</span>
<a name="l00113"></a><a class="code" href="btree_8h.html#a7c84776165eab9313f3db95a575d2eee">00113</a> <span class="preprocessor">#define CCN_BT_ACTIVITY_UPDATE_BUMP 16</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">/** Limit to the number of btree nodes kept open when idle */</span>
<a name="l00116"></a><a class="code" href="btree_8h.html#adf5b6ce2d1428889ca2630907c6555ec">00116</a> <span class="preprocessor">#define CCN_BT_OPEN_NODES_IDLE 5</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="comment">/** Limit to the number of file descriptors the btree should use at a time */</span>
<a name="l00118"></a><a class="code" href="btree_8h.html#adf5041f237d6de12af12a00b53837765">00118</a> <span class="preprocessor">#define CCN_BT_OPEN_NODES_LIMIT 13</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">/**</span>
<a name="l00122"></a>00122 <span class="comment"> * State associated with a btree as a whole</span>
<a name="l00123"></a>00123 <span class="comment"> */</span>
<a name="l00124"></a><a class="code" href="structccn__btree.html">00124</a> <span class="keyword">struct </span><a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> {
<a name="l00125"></a><a class="code" href="structccn__btree.html#a30b9aa24a148659b3f3d76238ff2b99c">00125</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structccn__btree.html#a30b9aa24a148659b3f3d76238ff2b99c" title="for making sure we point to a btree">magic</a>;             <span class="comment">/**&lt; for making sure we point to a btree */</span>
<a name="l00126"></a><a class="code" href="structccn__btree.html#ab36d17b50a56d9674cf6f42b8a962284">00126</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree.html#ab36d17b50a56d9674cf6f42b8a962284" title="for allocating new btree nodes">nextnodeid</a>;    <span class="comment">/**&lt; for allocating new btree nodes */</span>
<a name="l00127"></a><a class="code" href="structccn__btree.html#aab4566eb985e461fafb12256cc9bc0c3">00127</a>     <span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *<a class="code" href="structccn__btree.html#aab4566eb985e461fafb12256cc9bc0c3" title="storage layer">io</a>;    <span class="comment">/**&lt; storage layer */</span>
<a name="l00128"></a><a class="code" href="structccn__btree.html#a9f3a3eee94085a3a67f2f9a4cc0e462d">00128</a>     <span class="keyword">struct </span>hashtb *<a class="code" href="structccn__btree.html#a9f3a3eee94085a3a67f2f9a4cc0e462d" title="of ccn_btree_node, by nodeid">resident</a>;    <span class="comment">/**&lt; of ccn_btree_node, by nodeid */</span>
<a name="l00129"></a><a class="code" href="structccn__btree.html#a30135b7e840bfc2d17df06bd834f81ea">00129</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree.html#a30135b7e840bfc2d17df06bd834f81ea" title="undersize node that needs spilling">nextspill</a>;     <span class="comment">/**&lt; undersize node that needs spilling */</span>
<a name="l00130"></a><a class="code" href="structccn__btree.html#a50fd3a30a0138025064d1873faa03e44">00130</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree.html#a50fd3a30a0138025064d1873faa03e44" title="oversize node that needs splitting">nextsplit</a>;     <span class="comment">/**&lt; oversize node that needs splitting */</span>
<a name="l00131"></a><a class="code" href="structccn__btree.html#a91100c455d7ec69a8a53ff4609efdab8">00131</a>     <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree.html#a91100c455d7ec69a8a53ff4609efdab8" title="should stay zero">missedsplit</a>;   <span class="comment">/**&lt; should stay zero */</span>
<a name="l00132"></a><a class="code" href="structccn__btree.html#aaa350aa906874e5d03343ee1647d1451">00132</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#aaa350aa906874e5d03343ee1647d1451" title="counter for detected errors">errors</a>;                 <span class="comment">/**&lt; counter for detected errors */</span>
<a name="l00133"></a><a class="code" href="structccn__btree.html#a06c61f9dfb4cf364a2fa4d9d07c21461">00133</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#a06c61f9dfb4cf364a2fa4d9d07c21461" title="if nonzero, cleaning might be needed">cleanreq</a>;               <span class="comment">/**&lt; if nonzero, cleaning might be needed */</span>
<a name="l00134"></a>00134     <span class="comment">/* tunables */</span>
<a name="l00135"></a><a class="code" href="structccn__btree.html#a6e34d3aafbc23aab1c8a095bddfc6713">00135</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#a6e34d3aafbc23aab1c8a095bddfc6713" title="split internal nodes bigger than this">full</a>;                   <span class="comment">/**&lt; split internal nodes bigger than this */</span>
<a name="l00136"></a><a class="code" href="structccn__btree.html#aa31ab22689ed9888552c5cfc9b17c208">00136</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#aa31ab22689ed9888552c5cfc9b17c208" title="split leaf nodes bigger than this">full0</a>;                  <span class="comment">/**&lt; split leaf nodes bigger than this */</span>
<a name="l00137"></a><a class="code" href="structccn__btree.html#a0860762e2b9ad9921e027bbea0fa91a3">00137</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#a0860762e2b9ad9921e027bbea0fa91a3" title="limit size of node">nodebytes</a>;              <span class="comment">/**&lt; limit size of node */</span>
<a name="l00138"></a><a class="code" href="structccn__btree.html#ad9d3e45bdf013fabb9da4985b1629488">00138</a>     <span class="keywordtype">int</span> <a class="code" href="structccn__btree.html#ad9d3e45bdf013fabb9da4985b1629488" title="limit resident size">nodepool</a>;               <span class="comment">/**&lt; limit resident size */</span>
<a name="l00139"></a>00139 };
<a name="l00140"></a>00140 <span class="comment"></span>
<a name="l00141"></a>00141 <span class="comment">/**</span>
<a name="l00142"></a>00142 <span class="comment"> *  Structure of a node.</span>
<a name="l00143"></a>00143 <span class="comment"> *  </span>
<a name="l00144"></a>00144 <span class="comment"> *  These are as they appear on external storage, so we stick to </span>
<a name="l00145"></a>00145 <span class="comment"> *  single-byte types to keep it portable between machines.</span>
<a name="l00146"></a>00146 <span class="comment"> *  Multi-byte numeric fields are always in big-endian format.</span>
<a name="l00147"></a>00147 <span class="comment"> *</span>
<a name="l00148"></a>00148 <span class="comment"> *  Within a node, the entries are fixed size.</span>
<a name="l00149"></a>00149 <span class="comment"> *  The entries are packed together at the end of the node&#39;s storage,</span>
<a name="l00150"></a>00150 <span class="comment"> *  so that by examining the last entry the location of the other entries</span>
<a name="l00151"></a>00151 <span class="comment"> *  can be determined directly.  The entsz field includes the whole entry,</span>
<a name="l00152"></a>00152 <span class="comment"> *  which consists of a payload followed by a trailer.</span>
<a name="l00153"></a>00153 <span class="comment"> *</span>
<a name="l00154"></a>00154 <span class="comment"> *  The keys are stored in the first portion of the node.  They may be</span>
<a name="l00155"></a>00155 <span class="comment"> *  in multiple pieces, and the pieces may overlap arbitrarily.  This offers</span>
<a name="l00156"></a>00156 <span class="comment"> *  a very simple form of compression, since the keys within a node are</span>
<a name="l00157"></a>00157 <span class="comment"> *  very likely to have a lot in common with each other.</span>
<a name="l00158"></a>00158 <span class="comment"> *</span>
<a name="l00159"></a>00159 <span class="comment"> *  A few bytes at the very beginning serve as a header.</span>
<a name="l00160"></a>00160 <span class="comment"> *</span>
<a name="l00161"></a>00161 <span class="comment"> * This is the overall structure of a node:</span>
<a name="l00162"></a>00162 <span class="comment"> *</span>
<a name="l00163"></a>00163 <span class="comment"> *  +---+-----------------------+--------------+----+----+-- --+----+</span>
<a name="l00164"></a>00164 <span class="comment"> *  |hdr|..string......space....| (free space) | E0 | E1 | ... | En |</span>
<a name="l00165"></a>00165 <span class="comment"> *  +---+-----------------------+--------------+----+----+-- --+----+</span>
<a name="l00166"></a>00166 <span class="comment"> *</span>
<a name="l00167"></a>00167 <span class="comment"> * It is designed so that new entries can be added without having to</span>
<a name="l00168"></a>00168 <span class="comment"> * rewrite all of the string space.  Thus the header should not contain</span>
<a name="l00169"></a>00169 <span class="comment"> * things that we expect to change often.</span>
<a name="l00170"></a>00170 <span class="comment"> */</span>
<a name="l00171"></a><a class="code" href="structccn__btree__node__header.html">00171</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__node__header.html" title="Structure of a node.">ccn_btree_node_header</a> {
<a name="l00172"></a><a class="code" href="structccn__btree__node__header.html#aef5c692d11a591c9665ab174bb004a6b">00172</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__node__header.html#aef5c692d11a591c9665ab174bb004a6b" title="File magic.">magic</a>[4];     <span class="comment">/**&lt; File magic */</span>
<a name="l00173"></a><a class="code" href="structccn__btree__node__header.html#a3e3bd10095c1125be2fd811617019ed5">00173</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__node__header.html#a3e3bd10095c1125be2fd811617019ed5" title="Format version.">version</a>[1];   <span class="comment">/**&lt; Format version */</span>
<a name="l00174"></a><a class="code" href="structccn__btree__node__header.html#afd2bd9b5fb1e6a60dbfa5ce6cee7e599">00174</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__node__header.html#afd2bd9b5fb1e6a60dbfa5ce6cee7e599" title="Indicates root node, backup root, etc.">nodetype</a>[1];  <span class="comment">/**&lt; Indicates root node, backup root, etc. */</span>
<a name="l00175"></a><a class="code" href="structccn__btree__node__header.html#a6b6c961d781e7d491dbd10958118d0b5">00175</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__node__header.html#a6b6c961d781e7d491dbd10958118d0b5" title="Level within the tree.">level</a>[1];     <span class="comment">/**&lt; Level within the tree */</span>
<a name="l00176"></a><a class="code" href="structccn__btree__node__header.html#ac210d30059bf1d022fa64043ee8aa833">00176</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__node__header.html#ac210d30059bf1d022fa64043ee8aa833" title="Header extension size (CCN_BT_SIZE_UNITS).">extsz</a>[1];     <span class="comment">/**&lt; Header extension size (CCN_BT_SIZE_UNITS)*/</span>
<a name="l00177"></a>00177 };
<a name="l00178"></a>00178 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">/**</span>
<a name="l00180"></a>00180 <span class="comment"> *  Structure of a node entry trailer.</span>
<a name="l00181"></a>00181 <span class="comment"> *</span>
<a name="l00182"></a>00182 <span class="comment"> * This is how the last few bytes of each entry within a node are arranged.</span>
<a name="l00183"></a>00183 <span class="comment"> *</span>
<a name="l00184"></a>00184 <span class="comment"> */</span>
<a name="l00185"></a><a class="code" href="structccn__btree__entry__trailer.html">00185</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__entry__trailer.html" title="Structure of a node entry trailer.">ccn_btree_entry_trailer</a> {
<a name="l00186"></a><a class="code" href="structccn__btree__entry__trailer.html#ad7b3bbed8089101dbae51796258afffe">00186</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#ad7b3bbed8089101dbae51796258afffe" title="offset of piece 0 of the key">koff0</a>[4];     <span class="comment">/**&lt; offset of piece 0 of the key */</span>
<a name="l00187"></a><a class="code" href="structccn__btree__entry__trailer.html#a137adbe35c28124a8c42e5896d11b60c">00187</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#a137adbe35c28124a8c42e5896d11b60c" title="size of piece 0 of the key">ksiz0</a>[2];     <span class="comment">/**&lt; size of piece 0 of the key */</span>
<a name="l00188"></a><a class="code" href="structccn__btree__entry__trailer.html#abfc2132b4c975281dfec3bebdaf4766c">00188</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#abfc2132b4c975281dfec3bebdaf4766c" title="offset of piece 1">koff1</a>[4];     <span class="comment">/**&lt; offset of piece 1 */</span>
<a name="l00189"></a><a class="code" href="structccn__btree__entry__trailer.html#a0ea11493f4fdbe98052babf09bfcb66e">00189</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#a0ea11493f4fdbe98052babf09bfcb66e" title="size of piece 1">ksiz1</a>[2];     <span class="comment">/**&lt; size of piece 1 */</span>
<a name="l00190"></a><a class="code" href="structccn__btree__entry__trailer.html#a71db2004431ef542623e7a69dcd19bb7">00190</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#a71db2004431ef542623e7a69dcd19bb7" title="index of this entry within the node">entdx</a>[2];     <span class="comment">/**&lt; index of this entry within the node */</span>
<a name="l00191"></a><a class="code" href="structccn__btree__entry__trailer.html#a7a534f961351f1c7c6873444cba37a21">00191</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#a7a534f961351f1c7c6873444cba37a21" title="leaf nodes are at level 0">level</a>[1];     <span class="comment">/**&lt; leaf nodes are at level 0 */</span>
<a name="l00192"></a><a class="code" href="structccn__btree__entry__trailer.html#afe6d9e30387221438ea6ae1aa907ed7b">00192</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__entry__trailer.html#afe6d9e30387221438ea6ae1aa907ed7b" title="entry size in CCN_BT_SIZE_UNITS">entsz</a>[1];     <span class="comment">/**&lt; entry size in CCN_BT_SIZE_UNITS */</span>
<a name="l00193"></a>00193 };
<a name="l00194"></a><a class="code" href="btree_8h.html#ad16e925eb7979e11d8c914d71291269d">00194</a> <span class="preprocessor">#define CCN_BT_SIZE_UNITS 8</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span><span class="comment">/** Maximum key size, dictated by size of above size fields */</span>
<a name="l00196"></a><a class="code" href="btree_8h.html#a8118d42f2b6b916a43a67bd5969f6e63">00196</a> <span class="preprocessor">#define CCN_BT_MAX_KEY_SIZE 65535</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00198"></a>00198 <span class="comment">/**</span>
<a name="l00199"></a>00199 <span class="comment"> *  Structure of the entry payload within an internal (non-leaf) node.</span>
<a name="l00200"></a>00200 <span class="comment"> */</span>
<a name="l00201"></a><a class="code" href="structccn__btree__internal__payload.html">00201</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__internal__payload.html" title="Structure of the entry payload within an internal (non-leaf) node.">ccn_btree_internal_payload</a> {
<a name="l00202"></a><a class="code" href="structccn__btree__internal__payload.html#ad1d9092ad986549fcdaea62652597825">00202</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__internal__payload.html#ad1d9092ad986549fcdaea62652597825" title="CCN_BT_INTERNAL_MAGIC.">magic</a>[1];     <span class="comment">/**&lt; CCN_BT_INTERNAL_MAGIC */</span>
<a name="l00203"></a><a class="code" href="structccn__btree__internal__payload.html#a923910defeb8098b3b58ec928fa11cdd">00203</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__internal__payload.html#a923910defeb8098b3b58ec928fa11cdd" title="must be zero">pad</a>[3];       <span class="comment">/**&lt; must be zero */</span>
<a name="l00204"></a><a class="code" href="structccn__btree__internal__payload.html#ab146a4b9aaa27115d623cbfc548945a2">00204</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structccn__btree__internal__payload.html#ab146a4b9aaa27115d623cbfc548945a2" title="nodeid of a child">child</a>[4];     <span class="comment">/**&lt; nodeid of a child */</span>
<a name="l00205"></a>00205 };
<a name="l00206"></a><a class="code" href="btree_8h.html#a2d3a0f06ae2b7081b41783ee881882fd">00206</a> <span class="preprocessor">#define CCN_BT_INTERNAL_MAGIC 0xCC</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00208"></a>00208 <span class="comment"> *  Logical structure of the entry within an internal (non-leaf) node.</span>
<a name="l00209"></a>00209 <span class="comment"> */</span>
<a name="l00210"></a><a class="code" href="structccn__btree__internal__entry.html">00210</a> <span class="keyword">struct </span><a class="code" href="structccn__btree__internal__entry.html" title="Logical structure of the entry within an internal (non-leaf) node.">ccn_btree_internal_entry</a> {
<a name="l00211"></a><a class="code" href="structccn__btree__internal__entry.html#a30bd72c778f9abd652a68e87521778eb">00211</a>     <span class="keyword">struct </span><a class="code" href="structccn__btree__internal__payload.html" title="Structure of the entry payload within an internal (non-leaf) node.">ccn_btree_internal_payload</a> <a class="code" href="structccn__btree__internal__entry.html#a30bd72c778f9abd652a68e87521778eb">ie</a>;
<a name="l00212"></a><a class="code" href="structccn__btree__internal__entry.html#ad4ff1d341418a610fd5d224b38dc11c5">00212</a>     <span class="keyword">struct </span><a class="code" href="structccn__btree__entry__trailer.html" title="Structure of a node entry trailer.">ccn_btree_entry_trailer</a> <a class="code" href="structccn__btree__internal__entry.html#ad4ff1d341418a610fd5d224b38dc11c5">trailer</a>;
<a name="l00213"></a>00213 };
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">/* More extensive function descriptions are provided in the code. */</span>
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">/* Number of entries within the node */</span>
<a name="l00218"></a>00218 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a53f0208267d2b7670b87da0d125cc793" title="Number of entries within the btree node.">ccn_btree_node_nent</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">/* Node level (leaves are at level 0) */</span>
<a name="l00221"></a>00221 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a964ab008628d589088d51a77c172fcc0" title="Node level (leaves are at level 0).">ccn_btree_node_level</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="comment">/* Node entry size */</span>
<a name="l00224"></a>00224 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a3810b46c06c6c009dd65e100ba3aeb89" title="Size, in bytes, of entries within the node.">ccn_btree_node_getentrysize</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* Node payload size */</span>
<a name="l00227"></a>00227 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a91cc11d6d11d050e53dc3d314eef4fe3" title="Size, in bytes, of payloads within the node.">ccn_btree_node_payloadsize</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 <span class="comment">/* Get address of the indexed entry within node */</span>
<a name="l00230"></a>00230 <span class="keywordtype">void</span> *<a class="code" href="btree_8h.html#a12c112fedde6f330541a5894cf3a345c" title="Get the address of the indexed entry within the node.">ccn_btree_node_getentry</a>(<span class="keywordtype">size_t</span> payload_bytes,
<a name="l00231"></a>00231                               <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">/* Fetch the indexed key and place it into dst */</span>
<a name="l00234"></a>00234 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#ad478f017de60f13b836c49bf80da0bf7" title="Fetch the key within the indexed entry of node.">ccn_btree_key_fetch</a>(<span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *dst,
<a name="l00235"></a>00235                         <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="comment">/* Append the indexed key to dst */</span>
<a name="l00238"></a>00238 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#adbbf114a7a7ab71685ab9f7ef7d4a3e6" title="Append the key within the indexed entry of node to dst.">ccn_btree_key_append</a>(<span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *dst,
<a name="l00239"></a>00239                          <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">/* Compare given key with the key in the indexed entry of the node */</span>
<a name="l00242"></a>00242 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a16d8c91d021ee1b50cd683dc7d4d53a9" title="Compare given key with the key in the indexed entry of the node.">ccn_btree_compare</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> size,
<a name="l00243"></a>00243                       <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i);
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="btree_8h.html#ae049b8a0f5ba72ef645c77996e1e3dbf">00245</a> <span class="preprocessor">#define CCN_BT_ENCRES(ndx, success) (2 * (ndx) + ((success) || 0))</span>
<a name="l00246"></a><a class="code" href="btree_8h.html#aa96ab187e6de12451cfec3cb3276fbad">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define CCN_BT_SRCH_FOUND(res) ((res) &amp; 1)</span>
<a name="l00247"></a><a class="code" href="btree_8h.html#ae81f5445d9059cdb49f88700c6be6260">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define CCN_BT_SRCH_INDEX(res) ((res) &gt;&gt; 1)</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="comment">/* Search within the node for the key, or something near it */</span>
<a name="l00249"></a>00249 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a962030880972eb33cffa68a8dcc7a67e" title="Search the node for the given key.">ccn_btree_searchnode</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> size,
<a name="l00250"></a>00250                          <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">/* Insert a new entry at slot i of node */</span>
<a name="l00253"></a>00253 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a4e37f446a434a87cbb9543e4255938ec" title="Insert a new entry into a node.">ccn_btree_insert_entry</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i,
<a name="l00254"></a>00254                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> keysize,
<a name="l00255"></a>00255                            <span class="keywordtype">void</span> *payload, <span class="keywordtype">size_t</span> payload_bytes);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">/* Delete the entry at slot i of node */</span>
<a name="l00258"></a>00258 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a76dee0722b2c356763f9a1e58e8b0762" title="Remove an entry from a btree node.">ccn_btree_delete_entry</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node, <span class="keywordtype">int</span> i);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">/* Initialize a btree node */</span>
<a name="l00261"></a>00261 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#aba692270580d406f7f881d5d40cfdf8a" title="Initialize the btree node.">ccn_btree_init_node</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node,
<a name="l00262"></a>00262                         <span class="keywordtype">int</span> <a class="code" href="structccn__btree__entry__trailer.html#a7a534f961351f1c7c6873444cba37a21" title="leaf nodes are at level 0">level</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nodetype, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> extsz);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* Test for an oversize node */</span>
<a name="l00265"></a>00265 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a0d606bd6911b6d69aa8560d6e4af5fc5" title="Test for an oversize node.">ccn_btree_oversize</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="comment">/* Test for unbalance */</span>
<a name="l00268"></a>00268 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a171342df16ccfe550df84f3b74d35ae9" title="Test for an unbalanced node.">ccn_btree_unbalance</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="comment">/* Check a node for internal consistency */</span>
<a name="l00271"></a>00271 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#af338eb7f9360355c0aa0f6745247aa27" title="Check a node for internal consistency.">ccn_btree_chknode</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="comment">/*</span>
<a name="l00274"></a>00274 <span class="comment"> * Overall btree operations</span>
<a name="l00275"></a>00275 <span class="comment"> */</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="comment">/* Handle creation and destruction */</span>
<a name="l00278"></a>00278 <span class="keyword">struct </span><a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *<a class="code" href="btree_8h.html#aaab88f1077912aeeb0eec02181dfa303" title="Create a new btree handle, not attached to any external files.">ccn_btree_create</a>(<span class="keywordtype">void</span>);
<a name="l00279"></a>00279 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a3f0626bf0f9bd713268568ac778c07e1" title="Destroys a btree handle, shutting things down cleanly.">ccn_btree_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> **);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">/* Record an error */</span>
<a name="l00282"></a>00282 <span class="keywordtype">void</span> <a class="code" href="btree_8h.html#a1545710226fd52d5add9693d8e5d94bb" title="Keep count of noticed errors.">ccn_btree_note_error</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *bt, <span class="keywordtype">int</span> info);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">/* Access a node, creating or reading it if necessary */</span>
<a name="l00285"></a>00285 <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *<a class="code" href="btree_8h.html#a1d338dc49af6a334450d5ea747b30f7b" title="Access a btree node, creating or reading it if necessary.">ccn_btree_getnode</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *bt,
<a name="l00286"></a>00286                                          <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__node.html#a62d9b233a14f2af1d5a0033b856cc849" title="Identity of node.">nodeid</a>,
<a name="l00287"></a>00287                                          <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> parentid);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="comment">/* Get a node handle if it is already resident */</span>
<a name="l00290"></a>00290 <span class="keyword">struct </span><a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *<a class="code" href="btree_8h.html#ab6f6b815d73dcd1ba2f3c06e8909aa90" title="Access a btree node that is already resident.">ccn_btree_rnode</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *bt,
<a name="l00291"></a>00291                                        <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__node.html#a62d9b233a14f2af1d5a0033b856cc849" title="Identity of node.">nodeid</a>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">/* Clean a node and release io resources, retaining cached node in memory */</span>
<a name="l00294"></a>00294 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a101a77d88dfcd78834bcb18afb2726b9" title="Write out any pending changes, mark the node clean, and release node iodata.">ccn_btree_close_node</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="comment">/* Do a lookup, starting from the default root */</span>
<a name="l00297"></a>00297 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#ac7c8275b9cf7e77bd98e783bcaad3bb4" title="Do a btree lookup, starting from the default root.">ccn_btree_lookup</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree,
<a name="l00298"></a>00298                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> size,
<a name="l00299"></a>00299                      <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> **leafp);
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">/* Do a lookup, starting from the provided root and stopping at stoplevel */</span>
<a name="l00302"></a>00302 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#ab09151e71d638467fdf8c5a21d659ca8" title="Do a btree lookup, starting from the provided root and stopping at stoplevel.">ccn_btree_lookup_internal</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree,
<a name="l00303"></a>00303                      <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *root, <span class="keywordtype">int</span> stoplevel,
<a name="l00304"></a>00304                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> size,
<a name="l00305"></a>00305                      <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> **ansp);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="comment">/* Search for nodeid in parent */</span> 
<a name="l00308"></a>00308 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a1660ef8caf7bdd794d775b235647815d" title="Search for nodeid in parent.">ccn_btree_index_in_parent</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *<a class="code" href="structccn__btree__node.html#a88ed2264b36bcdaca0eb0f33ac3e51a4" title="Parent node id; 0 if unknown.">parent</a>,
<a name="l00309"></a>00309                               <a class="code" href="btree_8h.html#aa302edee5118eed1881dac5108371a09">ccn_btnodeid</a> <a class="code" href="structccn__btree__node.html#a62d9b233a14f2af1d5a0033b856cc849" title="Identity of node.">nodeid</a>);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="comment">/* Find the leaf that comes after the given node */</span>
<a name="l00312"></a>00312 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a920dcb30f9b5ce208c144d2eec63bd78" title="Find the leaf that comes after the given node.">ccn_btree_next_leaf</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree,
<a name="l00313"></a>00313                         <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node,
<a name="l00314"></a>00314                         <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> **ansp);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">/* Find the leaf that comes before the given node */</span>
<a name="l00317"></a>00317 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a746c4c3b7a0431c3353b79aff534d2e8" title="Find the leaf that comes before the given node.">ccn_btree_prev_leaf</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree,
<a name="l00318"></a>00318                         <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node,
<a name="l00319"></a>00319                         <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> **ansp);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="comment">/* Split a node into two */</span>
<a name="l00322"></a>00322 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a881bc0f4b86daa2a7a0291382f4865de" title="Split a btree node.">ccn_btree_split</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="comment">/* Spill a node over into sibling */</span>
<a name="l00325"></a>00325 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#a7293cf11a568723bda92cb5cd61caa41" title="Eliminate a node by combining it with a sibling.">ccn_btree_spill</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="comment">/* Prepare to update a node */</span>
<a name="l00328"></a>00328 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#aa2e6c5c102528fc84744dec2a10f08e1" title="Get ready to update a btree node.">ccn_btree_prepare_for_update</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *bt,
<a name="l00329"></a>00329                                  <span class="keyword">struct</span> <a class="code" href="structccn__btree__node.html" title="State associated with a btree node.">ccn_btree_node</a> *node);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 <span class="comment">/* Check the whole btree carefully */</span>
<a name="l00332"></a>00332 <span class="keywordtype">int</span> <a class="code" href="btree_8h.html#ac518380f0561d0852cd9ba6ebaee2811" title="Check the structure of the btree for consistency.">ccn_btree_check</a>(<span class="keyword">struct</span> <a class="code" href="structccn__btree.html" title="State associated with a btree as a whole.">ccn_btree</a> *btree, FILE *outfp);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">/*</span>
<a name="l00335"></a>00335 <span class="comment"> * Storage layer - client can provide other options</span>
<a name="l00336"></a>00336 <span class="comment"> */</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="comment">/* For btree node storage in files */</span>
<a name="l00339"></a>00339 <span class="keyword">struct </span><a class="code" href="structccn__btree__io.html" title="Holds the methods and the associated common data.">ccn_btree_io</a> *<a class="code" href="btree_8h.html#ad5b664c9c2e9fd535b11a7ce6aaf116d" title="Create a btree storage layer from a directory.">ccn_btree_io_from_directory</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path,
<a name="l00340"></a>00340                                                  <span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *msgs);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="comment">/* Low-level field access */</span>
<a name="l00343"></a>00343 <span class="keywordtype">unsigned</span> <a class="code" href="btree_8h.html#aab31ae32858e3cca2559fc2ab36480da">ccn_btree_fetchval</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <span class="keywordtype">int</span> size);
<a name="l00344"></a>00344 <span class="keywordtype">void</span> <a class="code" href="btree_8h.html#a21d4909338c9f22738daca415c2bf89e">ccn_btree_storeval</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <span class="keywordtype">int</span> size, <span class="keywordtype">unsigned</span> v);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Feb 4 11:56:46 2013 for Content-Centric Networking in C by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
