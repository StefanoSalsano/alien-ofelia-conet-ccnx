<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Content-Centric Networking in C: sync/sync_diff.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_a2ce97d05a9d430b2851eef455e009f7.html">sync</a>
  </div>
</div>
<div class="contents">
<h1>sync_diff.h</h1><a href="sync__diff_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * @file sync/sync_protocol.h</span>
<a name="l00003"></a>00003 <span class="comment"> *  </span>
<a name="l00004"></a>00004 <span class="comment"> * Part of CCNx Sync.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This library is free software; you can redistribute it and/or modify it</span>
<a name="l00007"></a>00007 <span class="comment"> * under the terms of the GNU Lesser General Public License version 2.1</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00012"></a>00012 <span class="comment"> * Lesser General Public License for more details. You should have received</span>
<a name="l00013"></a>00013 <span class="comment"> * a copy of the GNU Lesser General Public License along with this library;</span>
<a name="l00014"></a>00014 <span class="comment"> * if not, write to the Free Software Foundation, Inc., 51 Franklin Street,</span>
<a name="l00015"></a>00015 <span class="comment"> * Fifth Floor, Boston, MA 02110-1301 USA.</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef CCN_SyncDiff</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define CCN_SyncDiff</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="charbuf_8h.html" title="Expandable character buffer for counted sequences of arbitrary octets.">ccn/charbuf.h</a>&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="schedule_8h.html" title="Event scheduling.">ccn/schedule.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_sync_hash_cache_8h.html" title="Part of CCNx Sync.">SyncHashCache.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_sync_root_8h.html" title="Part of CCNx Sync.">SyncRoot.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="_sync_tree_worker_8h.html" title="Part of CCNx Sync.">SyncTreeWorker.h</a>&quot;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bf">00027</a> <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bf">sync_diff_side</a> {
<a name="l00028"></a><a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bfa73be5c5095f769655c3d5f621c45b40a">00028</a>     <a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bfa73be5c5095f769655c3d5f621c45b40a">sync_diff_X</a>,
<a name="l00029"></a><a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bfa4f99506bd13ae2ecfa3b2d111e588326">00029</a>     <a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bfa4f99506bd13ae2ecfa3b2d111e588326">sync_diff_Y</a>
<a name="l00030"></a>00030 };
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">/**</span>
<a name="l00033"></a>00033 <span class="comment"> * sync_diff_add_closure is called from the differencing operation to note</span>
<a name="l00034"></a>00034 <span class="comment"> * a name difference for sdd.  If name == NULL then there are no more names</span>
<a name="l00035"></a>00035 <span class="comment"> * to be produced, and there should be no future references to sdd.</span>
<a name="l00036"></a>00036 <span class="comment"> * The data is private to the closure, and the client owns all storage</span>
<a name="l00037"></a>00037 <span class="comment"> * in the closure, except for sync_diff_data.</span>
<a name="l00038"></a>00038 <span class="comment"> */</span>
<a name="l00039"></a><a class="code" href="structsync__diff__add__closure.html">00039</a> <span class="keyword">struct </span><a class="code" href="structsync__diff__add__closure.html" title="sync_diff_add_closure is called from the differencing operation to note a name difference...">sync_diff_add_closure</a> {
<a name="l00040"></a><a class="code" href="structsync__diff__add__closure.html#a9fe212376ec8cb5f4ec35ccae87b7876">00040</a>     int (* <a class="code" href="structsync__diff__add__closure.html#a9fe212376ec8cb5f4ec35ccae87b7876">add</a>)(<span class="keyword">struct </span><a class="code" href="structsync__diff__add__closure.html" title="sync_diff_add_closure is called from the differencing operation to note a name difference...">sync_diff_add_closure</a> *ac,
<a name="l00041"></a>00041                 <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *name);
<a name="l00042"></a><a class="code" href="structsync__diff__add__closure.html#a5cb927b54f5e3c435382c45080e62442">00042</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__data.html">sync_diff_data</a> *<a class="code" href="structsync__diff__add__closure.html#a5cb927b54f5e3c435382c45080e62442">diff_data</a>;
<a name="l00043"></a><a class="code" href="structsync__diff__add__closure.html#a7513589aec44e7a8cd2f5814fbff9517">00043</a>     <span class="keywordtype">void</span> *<a class="code" href="structsync__diff__add__closure.html#a7513589aec44e7a8cd2f5814fbff9517">data</a>;
<a name="l00044"></a>00044 };
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="structsync__diff__fetch__data.html">00046</a> <span class="keyword">struct </span><a class="code" href="structsync__diff__fetch__data.html">sync_diff_fetch_data</a> {
<a name="l00047"></a><a class="code" href="structsync__diff__fetch__data.html#a0996ee8ab9ca24a1b80bba72b9faf50f">00047</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__fetch__data.html">sync_diff_fetch_data</a> *<a class="code" href="structsync__diff__fetch__data.html#a0996ee8ab9ca24a1b80bba72b9faf50f">next</a>;
<a name="l00048"></a><a class="code" href="structsync__diff__fetch__data.html#ace9463f437347a44f954a6133c155f00">00048</a>     <span class="keyword">struct </span><a class="code" href="structccn__closure.html" title="Handle for upcalls that allow clients receive notifications of incoming interests...">ccn_closure</a> *<a class="code" href="structsync__diff__fetch__data.html#ace9463f437347a44f954a6133c155f00">action</a>;
<a name="l00049"></a><a class="code" href="structsync__diff__fetch__data.html#a7b67bfcaa0fd8456ce3061393eb74722">00049</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__data.html">sync_diff_data</a> *<a class="code" href="structsync__diff__fetch__data.html#a7b67bfcaa0fd8456ce3061393eb74722">diff_data</a>;
<a name="l00050"></a><a class="code" href="structsync__diff__fetch__data.html#a8dbd1b4a1d501f88e83a7f0869abaee8">00050</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *<a class="code" href="structsync__diff__fetch__data.html#a8dbd1b4a1d501f88e83a7f0869abaee8">hash_cache_entry</a>;
<a name="l00051"></a><a class="code" href="structsync__diff__fetch__data.html#ac8126dbb54d8ac5db5fd3fcf3e44424f">00051</a>     <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#a6e15e35d7afe80f23fa4bda464bc86bf">sync_diff_side</a> <a class="code" href="structsync__diff__fetch__data.html#ac8126dbb54d8ac5db5fd3fcf3e44424f">side</a>;
<a name="l00052"></a><a class="code" href="structsync__diff__fetch__data.html#ac4db1e798ad619a2fdde5ee7bc081390">00052</a>     int64_t <a class="code" href="structsync__diff__fetch__data.html#ac4db1e798ad619a2fdde5ee7bc081390">startTime</a>;
<a name="l00053"></a>00053 };
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">/**</span>
<a name="l00056"></a>00056 <span class="comment"> * sync_diff_get_closure is called from the differencing operation when a</span>
<a name="l00057"></a>00057 <span class="comment"> * node is required for a cache entry.  The cache entry (ce)</span>
<a name="l00058"></a>00058 <span class="comment"> * is where the hash is kept.  If the client cares, the side (X or Y) is also</span>
<a name="l00059"></a>00059 <span class="comment"> * supplied.</span>
<a name="l00060"></a>00060 <span class="comment"> * The data is private to the closure.</span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a><a class="code" href="structsync__diff__get__closure.html">00062</a> <span class="keyword">struct </span><a class="code" href="structsync__diff__get__closure.html" title="sync_diff_get_closure is called from the differencing operation when a node is required...">sync_diff_get_closure</a> {
<a name="l00063"></a><a class="code" href="structsync__diff__get__closure.html#a76d4f2449b837ac6ffabdbf97273af12">00063</a>     int (* <span class="keyword">get</span>)(<span class="keyword">struct </span><a class="code" href="structsync__diff__get__closure.html" title="sync_diff_get_closure is called from the differencing operation when a node is required...">sync_diff_get_closure</a> *gc,
<a name="l00064"></a>00064                 <span class="keyword">struct </span><a class="code" href="structsync__diff__fetch__data.html">sync_diff_fetch_data</a> *fd);
<a name="l00065"></a><a class="code" href="structsync__diff__get__closure.html#a9c7f7cd6ad7f6a95eae29bdc54c8aff1">00065</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__data.html">sync_diff_data</a> *<a class="code" href="structsync__diff__get__closure.html#a9c7f7cd6ad7f6a95eae29bdc54c8aff1">diff_data</a>;
<a name="l00066"></a><a class="code" href="structsync__diff__get__closure.html#a293046dc5fa43dcecf48072b52c51629">00066</a>     <span class="keywordtype">void</span> *<a class="code" href="structsync__diff__get__closure.html#a293046dc5fa43dcecf48072b52c51629">data</a>;
<a name="l00067"></a>00067 };
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19">00069</a> <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19">sync_diff_state</a> {
<a name="l00070"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a6443961c8f5bd345cb1d099c1a3c7555">00070</a>     <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a6443961c8f5bd345cb1d099c1a3c7555">sync_diff_state_init</a>,
<a name="l00071"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19aedd95a178d4f8beca50d05ae01589bc8">00071</a>     <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19aedd95a178d4f8beca50d05ae01589bc8">sync_diff_state_preload</a>,
<a name="l00072"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a587cdef50036ca9a41091efe79a42dd2">00072</a>     <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a587cdef50036ca9a41091efe79a42dd2">sync_diff_state_busy</a>,
<a name="l00073"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a3201ee381d392a46812079cb64d5c0c0">00073</a>     <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19a3201ee381d392a46812079cb64d5c0c0">sync_diff_state_error</a>,
<a name="l00074"></a><a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19af4843063aa987f6dcf5db4f0042b8de4">00074</a>     <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19af4843063aa987f6dcf5db4f0042b8de4">sync_diff_state_done</a>
<a name="l00075"></a>00075 };
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="structsync__diff__data.html">00077</a> <span class="keyword">struct </span><a class="code" href="structsync__diff__data.html">sync_diff_data</a> {
<a name="l00078"></a>00078     
<a name="l00079"></a>00079     <span class="comment">/* items supplied by the client, not altered by sync_diff_stop */</span>
<a name="l00080"></a><a class="code" href="structsync__diff__data.html#a4c835d54dc03229f2856a1e0966b0d1c">00080</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *<a class="code" href="structsync__diff__data.html#a4c835d54dc03229f2856a1e0966b0d1c">root</a>;
<a name="l00081"></a><a class="code" href="structsync__diff__data.html#a5997cd58b4376ccf9f71e4bd7a454d1c">00081</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structsync__diff__data.html#a5997cd58b4376ccf9f71e4bd7a454d1c">hashX</a>;
<a name="l00082"></a><a class="code" href="structsync__diff__data.html#a55e8315cc447c98fca09ade2acd8ff23">00082</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structsync__diff__data.html#a55e8315cc447c98fca09ade2acd8ff23">hashY</a>;
<a name="l00083"></a><a class="code" href="structsync__diff__data.html#a8c48a9c5ac1c18f27b6ea84e8c8a3f88">00083</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__add__closure.html" title="sync_diff_add_closure is called from the differencing operation to note a name difference...">sync_diff_add_closure</a> *<a class="code" href="structsync__diff__data.html#a8c48a9c5ac1c18f27b6ea84e8c8a3f88">add_closure</a>;
<a name="l00084"></a><a class="code" href="structsync__diff__data.html#affea13f4cd89753b889c29af52683d65">00084</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__get__closure.html" title="sync_diff_get_closure is called from the differencing operation when a node is required...">sync_diff_get_closure</a> *<a class="code" href="structsync__diff__data.html#affea13f4cd89753b889c29af52683d65">get_closure</a>;
<a name="l00085"></a><a class="code" href="structsync__diff__data.html#a725c560f10f80f760936225159b4b857">00085</a>     <span class="keywordtype">void</span> *<a class="code" href="structsync__diff__data.html#a725c560f10f80f760936225159b4b857">client_data</a>;
<a name="l00086"></a>00086     
<a name="l00087"></a>00087     <span class="comment">/* items set as things progress, not reset by sync_diff_stop */</span>
<a name="l00088"></a><a class="code" href="structsync__diff__data.html#a67fc1283c7352412a50f417e07a855d9">00088</a>     <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#ae0c609194fbe6e000ccea19e6591dd19">sync_diff_state</a> <a class="code" href="structsync__diff__data.html#a67fc1283c7352412a50f417e07a855d9" title="summary state of comparison">state</a>;     <span class="comment">/**&lt; summary state of comparison */</span>
<a name="l00089"></a><a class="code" href="structsync__diff__data.html#aa2feef8569ab535932ad3170e9c41170">00089</a>     int64_t <a class="code" href="structsync__diff__data.html#aa2feef8569ab535932ad3170e9c41170" title="time marker for last successul node fetch">lastFetchOK</a>;            <span class="comment">/**&lt; time marker for last successul node fetch */</span>
<a name="l00090"></a><a class="code" href="structsync__diff__data.html#ac88ec31f887b4813bf31a9ed624020a1">00090</a>     int64_t <a class="code" href="structsync__diff__data.html#ac88ec31f887b4813bf31a9ed624020a1" title="time marker for sync_diff_start">startTime</a>;              <span class="comment">/**&lt; time marker for sync_diff_start */</span>
<a name="l00091"></a><a class="code" href="structsync__diff__data.html#aa134e2b168f70a1869f32f5ecb819f6d">00091</a>     int64_t <a class="code" href="structsync__diff__data.html#aa134e2b168f70a1869f32f5ecb819f6d" title="time marker for last compare step entry">lastEnter</a>;              <span class="comment">/**&lt; time marker for last compare step entry */</span>
<a name="l00092"></a><a class="code" href="structsync__diff__data.html#a1b914638474fab198be467a5caa9c0b2">00092</a>     int64_t <a class="code" href="structsync__diff__data.html#a1b914638474fab198be467a5caa9c0b2" title="time marker for stall determination">lastMark</a>;               <span class="comment">/**&lt; time marker for stall determination */</span>
<a name="l00093"></a><a class="code" href="structsync__diff__data.html#a85e597d52688e91b19047f936bdb84e1">00093</a>     int64_t <a class="code" href="structsync__diff__data.html#a85e597d52688e91b19047f936bdb84e1" title="max time thread was held by compare">maxHold</a>;                <span class="comment">/**&lt; max time thread was held by compare */</span>    
<a name="l00094"></a><a class="code" href="structsync__diff__data.html#a2b5e8bbacc8ece0572d43ce7101964c3">00094</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__diff__data.html#a2b5e8bbacc8ece0572d43ce7101964c3" title="names added during this comparison">namesAdded</a>;                 <span class="comment">/**&lt; names added during this comparison */</span>
<a name="l00095"></a><a class="code" href="structsync__diff__data.html#ab73d161b4048d7b47b90fc165460c2b6">00095</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__diff__data.html#ab73d161b4048d7b47b90fc165460c2b6" title="number of busy remote node fetches">nodeFetchBusy</a>;              <span class="comment">/**&lt; number of busy remote node fetches */</span>
<a name="l00096"></a><a class="code" href="structsync__diff__data.html#a2570461f217f175955736961a677216d">00096</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__diff__data.html#a2570461f217f175955736961a677216d" title="number of failed remote node fetches">nodeFetchFailed</a>;            <span class="comment">/**&lt; number of failed remote node fetches */</span>
<a name="l00097"></a>00097     
<a name="l00098"></a>00098     <span class="comment">/* Internal resources: supplied by sync_diff_start, reset by sync_diff_stop */</span>
<a name="l00099"></a><a class="code" href="structsync__diff__data.html#a3f95b5a31ad339b0cd28f190288fe533">00099</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_tree_worker_head.html">SyncTreeWorkerHead</a> *<a class="code" href="structsync__diff__data.html#a3f95b5a31ad339b0cd28f190288fe533" title="&amp;quot;local&amp;quot; tree walker state">twX</a>; <span class="comment">/**&lt; &quot;local&quot; tree walker state */</span>
<a name="l00100"></a><a class="code" href="structsync__diff__data.html#aea271c342899152f5e314fdea4a26ab9">00100</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_tree_worker_head.html">SyncTreeWorkerHead</a> *<a class="code" href="structsync__diff__data.html#aea271c342899152f5e314fdea4a26ab9" title="&amp;quot;remote&amp;quot; tree walker state">twY</a>; <span class="comment">/**&lt; &quot;remote&quot; tree walker state */</span>
<a name="l00101"></a><a class="code" href="structsync__diff__data.html#a26751453e1f6d08681032db803534d4c">00101</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structsync__diff__data.html#a26751453e1f6d08681032db803534d4c" title="&amp;quot;local&amp;quot; tree scratch">cbX</a>;        <span class="comment">/**&lt; &quot;local&quot; tree scratch */</span>
<a name="l00102"></a><a class="code" href="structsync__diff__data.html#a03e23c9e9c1a157371f956e74292fa24">00102</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structsync__diff__data.html#a03e23c9e9c1a157371f956e74292fa24" title="&amp;quot;remote&amp;quot; tree scratch">cbY</a>;        <span class="comment">/**&lt; &quot;remote&quot; tree scratch */</span>
<a name="l00103"></a><a class="code" href="structsync__diff__data.html#a106732432ae0dc955f522dab508edc01">00103</a>     <span class="keyword">struct </span><a class="code" href="structsync__diff__fetch__data.html">sync_diff_fetch_data</a> *<a class="code" href="structsync__diff__data.html#a106732432ae0dc955f522dab508edc01" title="cache entries being fetched">fetchQ</a>; <span class="comment">/**&lt; cache entries being fetched */</span>
<a name="l00104"></a><a class="code" href="structsync__diff__data.html#a10ee698bc4a7227ceb48d52f9d113600">00104</a>     <span class="keyword">struct </span><a class="code" href="structccn__scheduled__event.html">ccn_scheduled_event</a> *<a class="code" href="structsync__diff__data.html#a10ee698bc4a7227ceb48d52f9d113600" title="progress event">ev</a>; <span class="comment">/**&lt; progress event */</span>
<a name="l00105"></a>00105 };
<a name="l00106"></a>00106 <span class="comment"></span>
<a name="l00107"></a>00107 <span class="comment">/**</span>
<a name="l00108"></a>00108 <span class="comment"> * sync_done_closure is called from the update operation when the new tree root</span>
<a name="l00109"></a>00109 <span class="comment"> * is ready for installation (in ud-&gt;ceStop).</span>
<a name="l00110"></a>00110 <span class="comment"> * The data is private to the closure.</span>
<a name="l00111"></a>00111 <span class="comment"> */</span>
<a name="l00112"></a><a class="code" href="structsync__done__closure.html">00112</a> <span class="keyword">struct </span><a class="code" href="structsync__done__closure.html" title="sync_done_closure is called from the update operation when the new tree root is ready...">sync_done_closure</a> {
<a name="l00113"></a><a class="code" href="structsync__done__closure.html#a8b27559822477f1b81b40b763405b3f5">00113</a>     int (* <a class="code" href="structsync__done__closure.html#a8b27559822477f1b81b40b763405b3f5">done</a>)(<span class="keyword">struct </span><a class="code" href="structsync__done__closure.html" title="sync_done_closure is called from the update operation when the new tree root is ready...">sync_done_closure</a> *dc);
<a name="l00114"></a><a class="code" href="structsync__done__closure.html#a501de5999eaacca19d2ca807f27232c5">00114</a>     <span class="keyword">struct </span><a class="code" href="structsync__update__data.html">sync_update_data</a> *<a class="code" href="structsync__done__closure.html#a501de5999eaacca19d2ca807f27232c5">update_data</a>;
<a name="l00115"></a><a class="code" href="structsync__done__closure.html#a493b5f130647ae4fab571f086ca277e8">00115</a>     <span class="keywordtype">void</span> *<a class="code" href="structsync__done__closure.html#a493b5f130647ae4fab571f086ca277e8">data</a>;
<a name="l00116"></a>00116 };
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43">00118</a> <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43">sync_update_state</a> {
<a name="l00119"></a><a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43abd92a419693725472c68e3acf34eaea0">00119</a>     <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43abd92a419693725472c68e3acf34eaea0">sync_update_state_init</a>,
<a name="l00120"></a><a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43ab61cf365039f6b818ef0cc5c3c05f680">00120</a>     <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43ab61cf365039f6b818ef0cc5c3c05f680">sync_update_state_busy</a>,
<a name="l00121"></a><a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43af6231151b8c191ec8435d2aa77f50809">00121</a>     <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43af6231151b8c191ec8435d2aa77f50809">sync_update_state_error</a>,
<a name="l00122"></a><a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43a65974dc44d485be21ba5c47dfdf06617">00122</a>     <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43a65974dc44d485be21ba5c47dfdf06617">sync_update_state_done</a>
<a name="l00123"></a>00123 };
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="structsync__update__data.html">00125</a> <span class="keyword">struct </span><a class="code" href="structsync__update__data.html">sync_update_data</a> {
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">/* items supplied by the client, not altered by sync_diff_stop */</span>
<a name="l00128"></a><a class="code" href="structsync__update__data.html#ae27a2fd5da60493df931427349b1419f">00128</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *<a class="code" href="structsync__update__data.html#ae27a2fd5da60493df931427349b1419f">root</a>;
<a name="l00129"></a><a class="code" href="structsync__update__data.html#afd203c8742791889903eea3a6156194f">00129</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *<a class="code" href="structsync__update__data.html#afd203c8742791889903eea3a6156194f">ceStart</a>; <span class="comment">/*&lt; entry for start hash (may be NULL) */</span>
<a name="l00130"></a><a class="code" href="structsync__update__data.html#a569d05589f22e952f099ae84ac415474">00130</a>     <span class="keyword">struct </span><a class="code" href="structsync__done__closure.html" title="sync_done_closure is called from the update operation when the new tree root is ready...">sync_done_closure</a> *<a class="code" href="structsync__update__data.html#a569d05589f22e952f099ae84ac415474">done_closure</a>;
<a name="l00131"></a><a class="code" href="structsync__update__data.html#a78d0205661707515607858aff4e423b5">00131</a>     <span class="keywordtype">void</span> *<a class="code" href="structsync__update__data.html#a78d0205661707515607858aff4e423b5">client_data</a>;
<a name="l00132"></a>00132     
<a name="l00133"></a>00133     <span class="comment">/* items set as things progress, not reset by sync_update_stop */</span>
<a name="l00134"></a><a class="code" href="structsync__update__data.html#a67f89b07bc95f9f25c4184b5d22326a1">00134</a>     <span class="keyword">enum</span> <a class="code" href="sync__diff_8h.html#a3786a893383525288e5f73ce5feb0a43">sync_update_state</a> <a class="code" href="structsync__update__data.html#a67f89b07bc95f9f25c4184b5d22326a1">state</a>;
<a name="l00135"></a><a class="code" href="structsync__update__data.html#ac62c008e26334cbc402fa4dc7470f08a">00135</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *<a class="code" href="structsync__update__data.html#ac62c008e26334cbc402fa4dc7470f08a">ceStop</a>;  <span class="comment">/*&lt; entry for end hash */</span>
<a name="l00136"></a><a class="code" href="structsync__update__data.html#a482162bc91d56387d879836f92285716">00136</a>     int64_t <a class="code" href="structsync__update__data.html#a482162bc91d56387d879836f92285716">startTime</a>;
<a name="l00137"></a><a class="code" href="structsync__update__data.html#a3723fa968d54f79ecc3da4bbcef7091c">00137</a>     int64_t <a class="code" href="structsync__update__data.html#a3723fa968d54f79ecc3da4bbcef7091c">entryTime</a>;
<a name="l00138"></a><a class="code" href="structsync__update__data.html#a6a26c4a94de42743b236887d9b0856bf">00138</a>     int64_t <a class="code" href="structsync__update__data.html#a6a26c4a94de42743b236887d9b0856bf">maxHold</a>;
<a name="l00139"></a><a class="code" href="structsync__update__data.html#a19060fdeb1e72c8aa562ddcba82744ff">00139</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__update__data.html#a19060fdeb1e72c8aa562ddcba82744ff">namesAdded</a>;
<a name="l00140"></a><a class="code" href="structsync__update__data.html#a0c50d872a6a7c598b87474c0b3f5e553">00140</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__update__data.html#a0c50d872a6a7c598b87474c0b3f5e553">nameLenAccum</a>;
<a name="l00141"></a>00141     
<a name="l00142"></a>00142     <span class="comment">/* Internal resources: supplied by sync_update_start, reset by sync_update_stop */</span>
<a name="l00143"></a><a class="code" href="structsync__update__data.html#ae5d5991473ca013be08c280623060509">00143</a>     <span class="keywordtype">int</span> <a class="code" href="structsync__update__data.html#ae5d5991473ca013be08c280623060509">ax</a>;
<a name="l00144"></a><a class="code" href="structsync__update__data.html#af93ce2f9b944704a210429631edae49c">00144</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *<a class="code" href="structsync__update__data.html#af93ce2f9b944704a210429631edae49c" title="sorted names from start_sync_update">adding</a>;   <span class="comment">/**&lt; sorted names from start_sync_update */</span>
<a name="l00145"></a><a class="code" href="structsync__update__data.html#a1cb1d7a80bfc2712d5b22bea479e32f1">00145</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *<a class="code" href="structsync__update__data.html#a1cb1d7a80bfc2712d5b22bea479e32f1" title="temp storage used while updating">names</a>;    <span class="comment">/**&lt; temp storage used while updating */</span>
<a name="l00146"></a><a class="code" href="structsync__update__data.html#a54c30a3acf32ec8669ce466e00b05af1">00146</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_node_accum.html">SyncNodeAccum</a> *<a class="code" href="structsync__update__data.html#a54c30a3acf32ec8669ce466e00b05af1" title="temp storage used while updating">nodes</a>;    <span class="comment">/**&lt; temp storage used while updating */</span>
<a name="l00147"></a><a class="code" href="structsync__update__data.html#abd7c89908b0b14fbe51592a8c42b881c">00147</a>     <span class="keyword">struct </span><a class="code" href="struct_sync_tree_worker_head.html">SyncTreeWorkerHead</a> *<a class="code" href="structsync__update__data.html#abd7c89908b0b14fbe51592a8c42b881c">tw</a>;
<a name="l00148"></a><a class="code" href="structsync__update__data.html#a95435eb475deb0007ba15c50be1d088f">00148</a>     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="structsync__update__data.html#a95435eb475deb0007ba15c50be1d088f">cb</a>;
<a name="l00149"></a><a class="code" href="structsync__update__data.html#a8a4d113ce8990e961a9496424d8c0847">00149</a>     <span class="keyword">struct </span><a class="code" href="structccn__scheduled__event.html">ccn_scheduled_event</a> *<a class="code" href="structsync__update__data.html#a8a4d113ce8990e961a9496424d8c0847" title="progress event">ev</a>; <span class="comment">/**&lt; progress event */</span>
<a name="l00150"></a>00150 };
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">/**</span>
<a name="l00153"></a>00153 <span class="comment"> * sync_diff_start starts a differencing operation between two sync trees,</span>
<a name="l00154"></a>00154 <span class="comment"> * specified by sdd-&gt;hashX and sdd-&gt;hashY for the collection in sdd-&gt;root.</span>
<a name="l00155"></a>00155 <span class="comment"> * If sdd-&gt;hashX is not empty then there must be a valid cache entry for it.</span>
<a name="l00156"></a>00156 <span class="comment"> * If sdd-&gt;hashY is not empty then there must be a valid cache entry for it.</span>
<a name="l00157"></a>00157 <span class="comment"> * The root (in sdd-&gt;root) must be valid, and have a valid base and scheduler.</span>
<a name="l00158"></a>00158 <span class="comment"> * The client always owns the storage for sdd.</span>
<a name="l00159"></a>00159 <span class="comment"> *</span>
<a name="l00160"></a>00160 <span class="comment"> * The closure sdd-&gt;get is called when a sync tree node is needed to continue</span>
<a name="l00161"></a>00161 <span class="comment"> * the comparison, giving the name of the node (which has the hash as the</span>
<a name="l00162"></a>00162 <span class="comment"> * last component).  When the node has been fetched, the client should call</span>
<a name="l00163"></a>00163 <span class="comment"> * sync_diff_note_node, which will continue the comparison.</span>
<a name="l00164"></a>00164 <span class="comment"> * </span>
<a name="l00165"></a>00165 <span class="comment"> * The closure sdd-&gt;add is called once for each name that is covered by hashY</span>
<a name="l00166"></a>00166 <span class="comment"> * but not by hashX.  When there are no more additions then it is called once</span>
<a name="l00167"></a>00167 <span class="comment"> * with name == NULL.  The sdd-&gt;add closure is called with a name that may not</span>
<a name="l00168"></a>00168 <span class="comment"> * be valid after the call completes, so the client must copy the name</span>
<a name="l00169"></a>00169 <span class="comment"> * if it needs to persist.</span>
<a name="l00170"></a>00170 <span class="comment"> *</span>
<a name="l00171"></a>00171 <span class="comment"> * Hint: If sdd-&gt;hashX is the empty hash (NULL or length == 0),</span>
<a name="l00172"></a>00172 <span class="comment"> *     then the differencing operation is simply an enumeration operation.</span>
<a name="l00173"></a>00173 <span class="comment"> *</span>
<a name="l00174"></a>00174 <span class="comment"> * @returns &lt; 0 for failure, 0 if no difference running, &gt; 0 for success.</span>
<a name="l00175"></a>00175 <span class="comment"> */</span>
<a name="l00176"></a>00176 <span class="keywordtype">int</span>
<a name="l00177"></a>00177 <a class="code" href="sync__diff_8c.html#a86612ec768575d85f0d28d310bc71cf9" title="sync_diff_start starts a differencing operation between two sync trees, specified...">sync_diff_start</a>(<span class="keyword">struct</span> <a class="code" href="structsync__diff__data.html">sync_diff_data</a> *sdd);
<a name="l00178"></a>00178 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">/**</span>
<a name="l00180"></a>00180 <span class="comment"> * sync_diff_note_node is used to establish the result of the client closure</span>
<a name="l00181"></a>00181 <span class="comment"> * sdd-&gt;get, and restarts the comparison.</span>
<a name="l00182"></a>00182 <span class="comment"> * When the client closure sdd-&gt;get is called it should initiate the fetch or</span>
<a name="l00183"></a>00183 <span class="comment"> * construction of a sync tree node.  Depending on characteristics of the</span>
<a name="l00184"></a>00184 <span class="comment"> * client the sync tree node should be stored into either ce-&gt;ncL or ce-&gt;ncR,</span>
<a name="l00185"></a>00185 <span class="comment"> * and sync_diff_note_node should be called.  The flags in ce will be updated</span>
<a name="l00186"></a>00186 <span class="comment"> * by sync_diff_note_node.</span>
<a name="l00187"></a>00187 <span class="comment"> * @returns &lt; 0 for failure, no fetch queued for ce.</span>
<a name="l00188"></a>00188 <span class="comment"> * @returns 0 for no action, ce == NULL || ce has no node.</span>
<a name="l00189"></a>00189 <span class="comment"> * @returns &gt; 0 for success, fetch was queued and ce has a node.</span>
<a name="l00190"></a>00190 <span class="comment"> */</span>
<a name="l00191"></a>00191 <span class="keywordtype">int</span>
<a name="l00192"></a>00192 <a class="code" href="sync__diff_8c.html#ac2dcc6edc4b46bbc8514086b8dc263de" title="sync_diff_note_node is used to establish the result of the client closure sdd-&amp;gt;get...">sync_diff_note_node</a>(<span class="keyword">struct</span> <a class="code" href="structsync__diff__data.html">sync_diff_data</a> *sdd,
<a name="l00193"></a>00193                     <span class="keyword">struct</span> <a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *ce);
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">/**</span>
<a name="l00196"></a>00196 <span class="comment"> * sync_diff_stop will stop the differencing operation if it has not completed.</span>
<a name="l00197"></a>00197 <span class="comment"> * A call to sdd-&gt;add will NOT take place from within this call.</span>
<a name="l00198"></a>00198 <span class="comment"> * Internal resources are released.</span>
<a name="l00199"></a>00199 <span class="comment"> * @returns &lt; 0 for failure, 0 if already stopped, &gt; 0 for success.</span>
<a name="l00200"></a>00200 <span class="comment"> */</span>
<a name="l00201"></a>00201 <span class="keywordtype">int</span>
<a name="l00202"></a>00202 <a class="code" href="sync__diff_8c.html#a1be9171a2f9c634b8562511688f16222" title="sync_diff_stop will stop the differencing operation if it has not completed.">sync_diff_stop</a>(<span class="keyword">struct</span> <a class="code" href="structsync__diff__data.html">sync_diff_data</a> *sdd);
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">/**</span>
<a name="l00205"></a>00205 <span class="comment"> * sync_update_start is called to start an update of ud-&gt;ceStart,</span>
<a name="l00206"></a>00206 <span class="comment"> * based on the names added via acc, to result in a tree with root hash</span>
<a name="l00207"></a>00207 <span class="comment"> * stored in ud-&gt;ceStop.</span>
<a name="l00208"></a>00208 <span class="comment"> * @returns &lt; 0 for failure, 0 if update already running, &gt; 0 for success.</span>
<a name="l00209"></a>00209 <span class="comment"> */</span>
<a name="l00210"></a>00210 <span class="keywordtype">int</span>
<a name="l00211"></a>00211 <a class="code" href="sync__diff_8c.html#a3bb272eae464ab13b38049b71d84f3d1" title="sync_update_start is called to start an update of ud-&amp;gt;ceStart, based on the names...">sync_update_start</a>(<span class="keyword">struct</span> <a class="code" href="structsync__update__data.html">sync_update_data</a> *ud, <span class="keyword">struct</span> <a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *acc);
<a name="l00212"></a>00212 <span class="comment"></span>
<a name="l00213"></a>00213 <span class="comment">/**</span>
<a name="l00214"></a>00214 <span class="comment"> * sync_update_stop can be called to stop the update operation.</span>
<a name="l00215"></a>00215 <span class="comment"> * Internal resources are released.</span>
<a name="l00216"></a>00216 <span class="comment"> * @returns &lt; 0 for failure, 0 if no update running, &gt; 0 for success.</span>
<a name="l00217"></a>00217 <span class="comment"> */</span>
<a name="l00218"></a>00218 <span class="keywordtype">int</span>
<a name="l00219"></a>00219 <a class="code" href="sync__diff_8c.html#a79c577f4db986229fa0768e32782d3c3" title="sync_update_stop can be called to stop the update operation.">sync_update_stop</a>(<span class="keyword">struct</span> <a class="code" href="structsync__update__data.html">sync_update_data</a> *ud);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Feb 4 11:56:48 2013 for Content-Centric Networking in C by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
