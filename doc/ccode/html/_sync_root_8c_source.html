<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Content-Centric Networking in C: sync/SyncRoot.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_a2ce97d05a9d430b2851eef455e009f7.html">sync</a>
  </div>
</div>
<div class="contents">
<h1>SyncRoot.c</h1><a href="_sync_root_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment"> * @file sync/SyncRoot.c</span>
<a name="l00003"></a>00003 <span class="comment"> *  </span>
<a name="l00004"></a>00004 <span class="comment"> * Part of CCNx Sync.</span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 <span class="comment">/*</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (C) 2011-2012 Palo Alto Research Center, Inc.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This library is free software; you can redistribute it and/or modify it</span>
<a name="l00010"></a>00010 <span class="comment"> * under the terms of the GNU Lesser General Public License version 2.1</span>
<a name="l00011"></a>00011 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00012"></a>00012 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00015"></a>00015 <span class="comment"> * Lesser General Public License for more details. You should have received</span>
<a name="l00016"></a>00016 <span class="comment"> * a copy of the GNU Lesser General Public License along with this library;</span>
<a name="l00017"></a>00017 <span class="comment"> * if not, write to the Free Software Foundation, Inc., 51 Franklin Street,</span>
<a name="l00018"></a>00018 <span class="comment"> * Fifth Floor, Boston, MA 02110-1301 USA.</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="ccn_8h.html" title="This is the low-level interface for CCNx clients.">ccn/ccn.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="charbuf_8h.html" title="Expandable character buffer for counted sequences of arbitrary octets.">ccn/charbuf.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="coding_8h.html" title="Details of the ccn binary wire encoding.">ccn/coding.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="digest_8h.html" title="Message digest interface.">ccn/digest.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="indexbuf_8h.html" title="Expandable buffer of non-negative values.">ccn/indexbuf.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="schedule_8h.html" title="Event scheduling.">ccn/schedule.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="uri_8h.html" title="ccn-scheme uri conversions.">ccn/uri.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="loglevels_8h.html" title="Part of the CCNx C Library.">ccn/loglevels.h</a>&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="_sync_macros_8h.html" title="Part of CCNx Sync.">SyncMacros.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="_sync_private_8h.html" title="Part of CCNx Sync.">SyncPrivate.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="_sync_hash_cache_8h.html" title="Part of CCNx Sync.">SyncHashCache.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="_sync_util_8h.html" title="Part of CCNx Sync.">SyncUtil.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="_sync_root_8h.html" title="Part of CCNx Sync.">SyncRoot.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">///////////////////////////////////////////////////////</span>
<a name="l00041"></a>00041 <span class="comment"></span><span class="comment">// Routines for root management</span><span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">///////////////////////////////////////////////////////</span>
<a name="l00043"></a>00043 <span class="comment"></span><span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">/**</span>
<a name="l00045"></a>00045 <span class="comment"> * copies the filter, including copies of the names</span>
<a name="l00046"></a>00046 <span class="comment"> */</span>
<a name="l00047"></a>00047 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *
<a name="l00048"></a><a class="code" href="_sync_root_8c.html#a0faf8a12a346bef5f16e56fdb2a1c840">00048</a> <a class="code" href="_sync_root_8c.html#a0faf8a12a346bef5f16e56fdb2a1c840" title="copies the filter, including copies of the names">copyFilter</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *filter) {
<a name="l00049"></a>00049     <span class="keywordtype">int</span> i = 0;
<a name="l00050"></a>00050     <span class="keywordtype">int</span> <a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a> = filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>;
<a name="l00051"></a>00051     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *canon = <a class="code" href="_sync_util_8c.html#adcdacf16d78ec4fff95eff5f0d63446b">SyncAllocNameAccum</a>(len);
<a name="l00052"></a>00052     <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l00053"></a>00053         <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *name = filter-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a>;
<a name="l00054"></a>00054         <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *copy = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>();
<a name="l00055"></a>00055         <a class="code" href="charbuf_8h.html#aca88638b2e81602eb4a1da9be923dad7">ccn_charbuf_append_charbuf</a>(copy, name);
<a name="l00056"></a>00056         canon-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a> = copy;
<a name="l00057"></a>00057         canon-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a1d7698b1a8fe70c6e30e59231314a4c4">data</a> = filter-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a1d7698b1a8fe70c6e30e59231314a4c4">data</a>;
<a name="l00058"></a>00058         
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060     canon-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a> = len;
<a name="l00061"></a>00061     <span class="keywordflow">return</span> canon;
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">/**</span>
<a name="l00065"></a>00065 <span class="comment"> * canonicalizes the filter</span>
<a name="l00066"></a>00066 <span class="comment"> * returns an existing equivalent filter if one is found</span>
<a name="l00067"></a>00067 <span class="comment"> * otherwise copies the input filter, links it in, and returns the copy</span>
<a name="l00068"></a>00068 <span class="comment"> */</span>
<a name="l00069"></a>00069 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *
<a name="l00070"></a><a class="code" href="_sync_root_8c.html#ad66f7c61075d60f84e6300e36dcb6fcc">00070</a> <a class="code" href="_sync_root_8c.html#ad66f7c61075d60f84e6300e36dcb6fcc" title="canonicalizes the filter returns an existing equivalent filter if one is found otherwise...">canonFilter</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_base_struct.html">SyncBaseStruct</a> *base, <span class="keyword">struct</span> <a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *filter) {
<a name="l00071"></a>00071     <span class="keyword">struct </span><a class="code" href="struct_sync_private.html">SyncPrivate</a> *priv = base-&gt;<a class="code" href="struct_sync_base_struct.html#ab7d5452e09cb0b6e41205bc9f00e4bf8">priv</a>;
<a name="l00072"></a>00072     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum_list.html">SyncNameAccumList</a> *filters = priv-&gt;<a class="code" href="struct_sync_private.html#aa4bbc03907368c92e0070fc58014c06c">filters</a>;
<a name="l00073"></a>00073     <span class="keywordflow">while</span> (filters != NULL) {
<a name="l00074"></a>00074         <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *accum = filters-&gt;<a class="code" href="struct_sync_name_accum_list.html#aa8931c3116a6d82fe5832a647189a883">accum</a>;
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (accum != NULL) {
<a name="l00076"></a>00076             <span class="keywordflow">if</span> (accum-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a> == filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>) {
<a name="l00077"></a>00077                 <span class="keywordtype">int</span> i = 0;
<a name="l00078"></a>00078                 <span class="keywordtype">int</span> equal = 1;
<a name="l00079"></a>00079                 <span class="keywordflow">while</span> (i &lt; filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>) {
<a name="l00080"></a>00080                     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *x = filter-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a>;
<a name="l00081"></a>00081                     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *y = accum-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a>;
<a name="l00082"></a>00082                     <span class="keywordflow">if</span> (<a class="code" href="_sync_util_8c.html#a83e5cd9675cc633d9504bd3ee7c8f025">SyncCmpNames</a>(x, y) != 0) {
<a name="l00083"></a>00083                         equal = 0;
<a name="l00084"></a>00084                         <span class="keywordflow">break</span>;
<a name="l00085"></a>00085                     }
<a name="l00086"></a>00086                     i++;
<a name="l00087"></a>00087                 }
<a name="l00088"></a>00088                 <span class="keywordflow">if</span> (equal)
<a name="l00089"></a>00089                     <span class="comment">// found an existing filter</span>
<a name="l00090"></a>00090                     <span class="keywordflow">return</span> accum;
<a name="l00091"></a>00091             }
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093         filters = filters-&gt;<a class="code" href="struct_sync_name_accum_list.html#a7df0170aff4d66a1d2241b26641e8f11">next</a>;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     <span class="comment">// copy the filter, then link it in to the private data</span>
<a name="l00096"></a>00096     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *canon = <a class="code" href="_sync_root_8c.html#a0faf8a12a346bef5f16e56fdb2a1c840" title="copies the filter, including copies of the names">copyFilter</a>(filter);
<a name="l00097"></a>00097     filters = <a class="code" href="_sync_macros_8h.html#ab707d3cfcb52f2e2f819771123942548">NEW_STRUCT</a>(1, <a class="code" href="struct_sync_name_accum_list.html">SyncNameAccumList</a>);
<a name="l00098"></a>00098     filters-&gt;<a class="code" href="struct_sync_name_accum_list.html#a7df0170aff4d66a1d2241b26641e8f11">next</a> = priv-&gt;<a class="code" href="struct_sync_private.html#aa4bbc03907368c92e0070fc58014c06c">filters</a>;
<a name="l00099"></a>00099     priv-&gt;<a class="code" href="struct_sync_private.html#aa4bbc03907368c92e0070fc58014c06c">filters</a> = filters;
<a name="l00100"></a>00100     filters-&gt;<a class="code" href="struct_sync_name_accum_list.html#aa8931c3116a6d82fe5832a647189a883">accum</a> = canon;
<a name="l00101"></a>00101     <span class="keywordflow">return</span> canon;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *
<a name="l00105"></a><a class="code" href="_sync_root_8h.html#a18308ecffb5585c8bcbd63d20a7e85b5">00105</a> <a class="code" href="_sync_root_8c.html#a18308ecffb5585c8bcbd63d20a7e85b5" title="namesToAdd has the names where content is known to be present.">SyncAddRoot</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_base_struct.html">SyncBaseStruct</a> *<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a>,
<a name="l00106"></a>00106             <span class="keywordtype">int</span> syncScope,
<a name="l00107"></a>00107             <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="struct_sync_root_struct.html#a6ba6270127aea47744c6860e6aff6627" title="Sync Protocol topo prefix.">topoPrefix</a>,
<a name="l00108"></a>00108             <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a>,
<a name="l00109"></a>00109             <span class="keyword">struct</span> <a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *<a class="code" href="struct_sync_root_struct.html#a24acad680fbad7342bfc4a4c8f9fcf82" title="filter clauses">filter</a>) {
<a name="l00110"></a>00110     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root = <a class="code" href="_sync_macros_8h.html#ab707d3cfcb52f2e2f819771123942548">NEW_STRUCT</a>(1, <a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a>);
<a name="l00111"></a>00111     <span class="keyword">struct </span><a class="code" href="struct_sync_private.html">SyncPrivate</a> *priv = base-&gt;<a class="code" href="struct_sync_base_struct.html#ab7d5452e09cb0b6e41205bc9f00e4bf8">priv</a>;
<a name="l00112"></a>00112     <span class="keywordtype">int</span> newTopo = 0;
<a name="l00113"></a>00113     root-&gt;<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a> = base;
<a name="l00114"></a>00114     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a> = <a class="code" href="_sync_macros_8h.html#ab707d3cfcb52f2e2f819771123942548">NEW_STRUCT</a>(1, <a class="code" href="struct_sync_root_private.html">SyncRootPrivate</a>);
<a name="l00115"></a>00115     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>-&gt;<a class="code" href="struct_sync_root_private.html#a38e2e743a14abac78e109da409dfd072">stats</a> = <a class="code" href="_sync_macros_8h.html#ab707d3cfcb52f2e2f819771123942548">NEW_STRUCT</a>(1, <a class="code" href="struct_sync_root_stats.html">SyncRootStats</a>);
<a name="l00116"></a>00116     int64_t now = <a class="code" href="_sync_util_8c.html#a17f22694d0381f7cc758e3cb3a504283">SyncCurrentTime</a>();
<a name="l00117"></a>00117     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>-&gt;<a class="code" href="struct_sync_root_private.html#a9c79def61eb0960acdd5db128e76e4fe">lastAdvise</a> = now;
<a name="l00118"></a>00118     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>-&gt;<a class="code" href="struct_sync_root_private.html#ab12485a114af6f5de646eb708d579ef0">lastUpdate</a> = now;
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (syncScope &lt; 1 || syncScope &gt; 2)
<a name="l00120"></a>00120         <span class="comment">// invalid scopes treated as unscoped</span>
<a name="l00121"></a>00121         syncScope = -1;
<a name="l00122"></a>00122     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>-&gt;<a class="code" href="struct_sync_root_private.html#a043c6fc891ececbddbc4b446ecd5bc31">syncScope</a> = syncScope;
<a name="l00123"></a>00123     root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>-&gt;<a class="code" href="struct_sync_root_private.html#a312e33d7f5b862de736711a14f7210f8">sliceBusy</a> = -1;
<a name="l00124"></a>00124     base-&gt;<a class="code" href="struct_sync_base_struct.html#abe638c34346dea6704ab0d9a04230f8b">lastRootId</a>++;
<a name="l00125"></a>00125     root-&gt;<a class="code" href="struct_sync_root_struct.html#a86cbcbdd2e2d8c30311da406d36c80e5" title="root Id for reporting">rootId</a> = base-&gt;<a class="code" href="struct_sync_base_struct.html#abe638c34346dea6704ab0d9a04230f8b">lastRootId</a>;
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (topoPrefix != NULL) {
<a name="l00127"></a>00127         <span class="keywordtype">int</span> oldLen = priv-&gt;<a class="code" href="struct_sync_private.html#af49290350d7ce024b02786148c5c1f99">topoAccum</a>-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>;
<a name="l00128"></a>00128         root-&gt;<a class="code" href="struct_sync_root_struct.html#a6ba6270127aea47744c6860e6aff6627" title="Sync Protocol topo prefix.">topoPrefix</a> = <a class="code" href="_sync_util_8c.html#addd012fd8fb454747514c8c59fff0bb5" title="canonicalizes a name with respect to the given name accum should be used for relatively...">SyncNameAccumCanon</a>(priv-&gt;<a class="code" href="struct_sync_private.html#af49290350d7ce024b02786148c5c1f99">topoAccum</a>, topoPrefix);
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (oldLen &lt; priv-&gt;<a class="code" href="struct_sync_private.html#af49290350d7ce024b02786148c5c1f99">topoAccum</a>-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>) newTopo++;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (namingPrefix != NULL) {
<a name="l00132"></a>00132         root-&gt;<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a> = <a class="code" href="_sync_util_8c.html#addd012fd8fb454747514c8c59fff0bb5" title="canonicalizes a name with respect to the given name accum should be used for relatively...">SyncNameAccumCanon</a>(priv-&gt;<a class="code" href="struct_sync_private.html#a3cf765f8a2e165c037c672d2eb09f690">prefixAccum</a>, namingPrefix);
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (filter != NULL) {
<a name="l00135"></a>00135         root-&gt;<a class="code" href="struct_sync_root_struct.html#a24acad680fbad7342bfc4a4c8f9fcf82" title="filter clauses">filter</a> = <a class="code" href="_sync_root_8c.html#ad66f7c61075d60f84e6300e36dcb6fcc" title="canonicalizes the filter returns an existing equivalent filter if one is found otherwise...">canonFilter</a>(base, filter);
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *lag = priv-&gt;<a class="code" href="struct_sync_private.html#ab73c3970c30ef4b6d3bcf11eac0b5cef">rootHead</a>;
<a name="l00138"></a>00138     <span class="keywordflow">while</span> (lag != NULL) {
<a name="l00139"></a>00139         <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *<a class="code" href="struct_sync_root_struct.html#acd0d587d8fdf825a7145f5f26c86cac2" title="next root in our list">next</a> = lag-&gt;<a class="code" href="struct_sync_root_struct.html#acd0d587d8fdf825a7145f5f26c86cac2" title="next root in our list">next</a>;
<a name="l00140"></a>00140         <span class="keywordflow">if</span> (next == NULL) <span class="keywordflow">break</span>;
<a name="l00141"></a>00141         lag = next;
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (lag != NULL) lag-&gt;<a class="code" href="struct_sync_root_struct.html#acd0d587d8fdf825a7145f5f26c86cac2" title="next root in our list">next</a> = root;
<a name="l00144"></a>00144     <span class="keywordflow">else</span> priv-&gt;<a class="code" href="struct_sync_private.html#ab73c3970c30ef4b6d3bcf11eac0b5cef">rootHead</a> = root;
<a name="l00145"></a>00145     priv-&gt;<a class="code" href="struct_sync_private.html#a17d91740bea687c5cdb63ec6272a8727">nRoots</a>++;
<a name="l00146"></a>00146     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_head.html">SyncHashCacheHead</a> *ch = <a class="code" href="_sync_hash_cache_8c.html#adcd97f68b3c8364ff8fcee1b3c99e6d3" title="create a new hash table with the given modulus (mod == 0 uses a default)">SyncHashCacheCreate</a>(root, 64);
<a name="l00147"></a>00147     root-&gt;<a class="code" href="struct_sync_root_struct.html#a404384379387e0beb78ebfb7b81109f6" title="cache head">ch</a> = ch;
<a name="l00148"></a>00148     root-&gt;<a class="code" href="struct_sync_root_struct.html#a013f6ae133c768d7bff2495445283bb4" title="current top-level cache hash">currentHash</a> = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>(); <span class="comment">// initially empty!</span>
<a name="l00149"></a>00149     
<a name="l00150"></a>00150     <span class="comment">// init the state for name processing</span>
<a name="l00151"></a>00151     root-&gt;<a class="code" href="struct_sync_root_struct.html#a973c1488c9df1486c21fc37465c10def" title="names needing addition to root">namesToAdd</a> = <a class="code" href="_sync_util_8c.html#adcdacf16d78ec4fff95eff5f0d63446b">SyncAllocNameAccum</a>(0);
<a name="l00152"></a>00152     root-&gt;<a class="code" href="struct_sync_root_struct.html#ac28d004acf78c3ef247937c0b10d8b7c" title="names needing contents fetch">namesToFetch</a> = <a class="code" href="_sync_util_8c.html#adcdacf16d78ec4fff95eff5f0d63446b">SyncAllocNameAccum</a>(0);
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a> = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>();
<a name="l00155"></a>00155     root-&gt;<a class="code" href="struct_sync_root_struct.html#add7a152b7bdc85bd56a20b16f1da93f6" title="the raw hash of the sliceCoding">sliceHash</a> = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>();
<a name="l00156"></a>00156     <span class="keywordflow">if</span> (<a class="code" href="_sync_root_8c.html#a120e0cc1725f3c09a2f2d624387038b3" title="Appends the ccnb encoding for a config slice to the provided cb.">SyncRootAppendSlice</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a>, root) &gt;= 0) {
<a name="l00157"></a>00157         <span class="comment">// make a hash code from the encoding</span>
<a name="l00158"></a>00158         <span class="keyword">struct </span>ccn_digest *cow = <a class="code" href="digest_8h.html#a84e53fb02b4aa2097fe7279df658cf3e">ccn_digest_create</a>(<a class="code" href="digest_8h.html#aa78356f84244471f2bfc8dc5c1420027ac1de104a1616d0e0110452fc9cf36f72">CCN_DIGEST_DEFAULT</a>);
<a name="l00159"></a>00159         <span class="keywordtype">size_t</span> sz = <a class="code" href="digest_8h.html#ae3d1b5dbce5b9ff5d4cad6a56a3e93e5">ccn_digest_size</a>(cow);
<a name="l00160"></a>00160         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dst = <a class="code" href="charbuf_8h.html#a3e0e15f90919b9a4da02704830f09717">ccn_charbuf_reserve</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#add7a152b7bdc85bd56a20b16f1da93f6" title="the raw hash of the sliceCoding">sliceHash</a>, sz);
<a name="l00161"></a>00161         <a class="code" href="digest_8h.html#a8afbfaa6688046c374afc2018a062d8a">ccn_digest_init</a>(cow);
<a name="l00162"></a>00162         <a class="code" href="digest_8h.html#af81dac9e7af9b986ee37c714b283edb4">ccn_digest_update</a>(cow, root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a>-&gt;<a class="code" href="structccn__charbuf.html#af24075ee3911a992d0dda6f449f3b3b3">buf</a>, root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a>-&gt;<a class="code" href="structccn__charbuf.html#a8847707f323a0aa35e2a81001a2d1fbf">length</a>);
<a name="l00163"></a>00163         <a class="code" href="digest_8h.html#ab2aab2f4798076d6798ffb7b1db5639c">ccn_digest_final</a>(cow, dst, sz);
<a name="l00164"></a>00164         root-&gt;<a class="code" href="struct_sync_root_struct.html#add7a152b7bdc85bd56a20b16f1da93f6" title="the raw hash of the sliceCoding">sliceHash</a>-&gt;<a class="code" href="structccn__charbuf.html#a8847707f323a0aa35e2a81001a2d1fbf">length</a> = sz;
<a name="l00165"></a>00165         <a class="code" href="digest_8h.html#aa24780853d99b74e823f0babb34fee8e">ccn_digest_destroy</a>(&amp;cow);
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167     
<a name="l00168"></a>00168     <span class="keywordflow">return</span> root;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *
<a name="l00172"></a><a class="code" href="_sync_root_8h.html#a7e320127c8aedab8b84d66a5816bf0ec">00172</a> <a class="code" href="_sync_root_8c.html#a7e320127c8aedab8b84d66a5816bf0ec" title="Removes the root from the base, and frees up associated storage.">SyncRemRoot</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root) {
<a name="l00173"></a>00173     <span class="keywordflow">if</span> (root == NULL || root-&gt;<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a> == NULL || root-&gt;<a class="code" href="struct_sync_root_struct.html#afc1f6cd0fc635888971bee16931d4aa6" title="data for doing sync tree comparison">compare</a> != NULL)
<a name="l00174"></a>00174         <span class="comment">// NOTE: caller must ensure that there are no comparisons active!</span>
<a name="l00175"></a>00175         <span class="keywordflow">return</span> root;
<a name="l00176"></a>00176     <span class="keyword">struct </span><a class="code" href="struct_sync_base_struct.html">SyncBaseStruct</a> *base = root-&gt;<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a>;
<a name="l00177"></a>00177     <span class="keyword">struct </span><a class="code" href="struct_sync_private.html">SyncPrivate</a> *priv = base-&gt;<a class="code" href="struct_sync_base_struct.html#ab7d5452e09cb0b6e41205bc9f00e4bf8">priv</a>;
<a name="l00178"></a>00178     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *lag = NULL;
<a name="l00179"></a>00179     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *<span class="keyword">this</span> = priv-&gt;<a class="code" href="struct_sync_private.html#ab73c3970c30ef4b6d3bcf11eac0b5cef">rootHead</a>;
<a name="l00180"></a>00180     <span class="keywordflow">while</span> (<span class="keyword">this</span> != NULL) {
<a name="l00181"></a>00181         <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *<a class="code" href="struct_sync_root_struct.html#acd0d587d8fdf825a7145f5f26c86cac2" title="next root in our list">next</a> = this-&gt;next;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (<span class="keyword">this</span> == root) {
<a name="l00183"></a>00183             <span class="keyword">struct </span><a class="code" href="struct_sync_root_private.html">SyncRootPrivate</a> *rp = root-&gt;<a class="code" href="struct_sync_root_struct.html#ad1d9b29ffef3be9642a6e0a0d2c4ee02" title="private to SyncRoot">priv</a>;
<a name="l00184"></a>00184             <span class="keywordflow">if</span> (lag != NULL) lag-&gt;<a class="code" href="struct_sync_root_struct.html#acd0d587d8fdf825a7145f5f26c86cac2" title="next root in our list">next</a> = next;
<a name="l00185"></a>00185             <span class="keywordflow">else</span> priv-&gt;<a class="code" href="struct_sync_private.html#ab73c3970c30ef4b6d3bcf11eac0b5cef">rootHead</a> = next;
<a name="l00186"></a>00186             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a404384379387e0beb78ebfb7b81109f6" title="cache head">ch</a> != NULL)
<a name="l00187"></a>00187                 root-&gt;<a class="code" href="struct_sync_root_struct.html#a404384379387e0beb78ebfb7b81109f6" title="cache head">ch</a> = <a class="code" href="_sync_hash_cache_8c.html#ab1f4fdb69850160777d5427d9d057586" title="frees the cache resources caller must ensure no further use of the cache">SyncHashCacheFree</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a404384379387e0beb78ebfb7b81109f6" title="cache head">ch</a>);
<a name="l00188"></a>00188             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a013f6ae133c768d7bff2495445283bb4" title="current top-level cache hash">currentHash</a> != NULL)
<a name="l00189"></a>00189                 <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;root-&gt;<a class="code" href="struct_sync_root_struct.html#a013f6ae133c768d7bff2495445283bb4" title="current top-level cache hash">currentHash</a>);
<a name="l00190"></a>00190             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a973c1488c9df1486c21fc37465c10def" title="names needing addition to root">namesToAdd</a> != NULL)
<a name="l00191"></a>00191                 <a class="code" href="_sync_util_8c.html#a6c2c47daae1a00b2fd20577c8bd7eef0" title="frees the name accum and all of the names">SyncFreeNameAccumAndNames</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a973c1488c9df1486c21fc37465c10def" title="names needing addition to root">namesToAdd</a>);
<a name="l00192"></a>00192             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#ac28d004acf78c3ef247937c0b10d8b7c" title="names needing contents fetch">namesToFetch</a> != NULL)
<a name="l00193"></a>00193                 <a class="code" href="_sync_util_8c.html#a6c2c47daae1a00b2fd20577c8bd7eef0" title="frees the name accum and all of the names">SyncFreeNameAccumAndNames</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#ac28d004acf78c3ef247937c0b10d8b7c" title="names needing contents fetch">namesToFetch</a>);
<a name="l00194"></a>00194             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a> != NULL)
<a name="l00195"></a>00195                 <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;root-&gt;<a class="code" href="struct_sync_root_struct.html#a5d596b7eb9b823455621925b2a02a066" title="ccnb encoding for the description">sliceCoding</a>);
<a name="l00196"></a>00196             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#add7a152b7bdc85bd56a20b16f1da93f6" title="the raw hash of the sliceCoding">sliceHash</a> != NULL)
<a name="l00197"></a>00197                 <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;root-&gt;<a class="code" href="struct_sync_root_struct.html#add7a152b7bdc85bd56a20b16f1da93f6" title="the raw hash of the sliceCoding">sliceHash</a>);
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (rp != NULL) {
<a name="l00199"></a>00199                 <span class="keywordflow">if</span> (rp-&gt;<a class="code" href="struct_sync_root_private.html#a38e2e743a14abac78e109da409dfd072">stats</a> != NULL) free(rp-&gt;<a class="code" href="struct_sync_root_private.html#a38e2e743a14abac78e109da409dfd072">stats</a>);
<a name="l00200"></a>00200                 <span class="keyword">struct </span><a class="code" href="struct_sync_hash_info_list.html">SyncHashInfoList</a> *list = rp-&gt;<a class="code" href="struct_sync_root_private.html#a7c217e7610fe07ecbf7ad85c2b4785c7">remoteSeen</a>;
<a name="l00201"></a>00201                 <span class="keywordflow">while</span> (list != NULL) {
<a name="l00202"></a>00202                     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_info_list.html">SyncHashInfoList</a> *lag = list;
<a name="l00203"></a>00203                     list = list-&gt;<a class="code" href="struct_sync_hash_info_list.html#a09d3622f803ab21ac48e83f1fafdd643">next</a>;
<a name="l00204"></a>00204                     free(lag);
<a name="l00205"></a>00205                 }
<a name="l00206"></a>00206                 list = rp-&gt;<a class="code" href="struct_sync_root_private.html#a7f856ccd9518ec05ad8605f8fb46a47b">localMade</a>;
<a name="l00207"></a>00207                 <span class="keywordflow">while</span> (list != NULL) {
<a name="l00208"></a>00208                     <span class="keyword">struct </span><a class="code" href="struct_sync_hash_info_list.html">SyncHashInfoList</a> *lag = list;
<a name="l00209"></a>00209                     list = list-&gt;<a class="code" href="struct_sync_hash_info_list.html#a09d3622f803ab21ac48e83f1fafdd643">next</a>;
<a name="l00210"></a>00210                     free(lag);
<a name="l00211"></a>00211                 }
<a name="l00212"></a>00212                 
<a name="l00213"></a>00213                 <span class="keyword">struct </span><a class="code" href="struct_sync_root_deltas.html">SyncRootDeltas</a> *deltas = rp-&gt;<a class="code" href="struct_sync_root_private.html#a5af352dcc2e4e1b3971291edcf79de1b">deltasHead</a>;
<a name="l00214"></a>00214                 <span class="keywordflow">while</span> (deltas != NULL) {
<a name="l00215"></a>00215                     <span class="keyword">struct </span><a class="code" href="struct_sync_root_deltas.html">SyncRootDeltas</a> *next = deltas-&gt;<a class="code" href="struct_sync_root_deltas.html#aa72728441fb5d92b6e88a173593be109">next</a>;
<a name="l00216"></a>00216                     <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;deltas-&gt;<a class="code" href="struct_sync_root_deltas.html#a2eb71f131a177b594dd505d31ef13f0c">coding</a>);
<a name="l00217"></a>00217                     <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;deltas-&gt;<a class="code" href="struct_sync_root_deltas.html#ad3f2b0e4b2c0363f5e79f98af9d6e7aa">name</a>);
<a name="l00218"></a>00218                     <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;deltas-&gt;<a class="code" href="struct_sync_root_deltas.html#a8b8de9e0004c44b94632a574d515c6c7">cob</a>);
<a name="l00219"></a>00219                     free(deltas);
<a name="l00220"></a>00220                     deltas = next;
<a name="l00221"></a>00221                 }
<a name="l00222"></a>00222                 <span class="keywordflow">if</span> (rp-&gt;<a class="code" href="struct_sync_root_private.html#aaf1e25bbca5a71684b2deefce4f2082f">remoteDeltas</a> != NULL) {
<a name="l00223"></a>00223                     <a class="code" href="_sync_util_8c.html#a6c2c47daae1a00b2fd20577c8bd7eef0" title="frees the name accum and all of the names">SyncFreeNameAccumAndNames</a>(rp-&gt;<a class="code" href="struct_sync_root_private.html#aaf1e25bbca5a71684b2deefce4f2082f">remoteDeltas</a>);
<a name="l00224"></a>00224                 }
<a name="l00225"></a>00225                 free(rp);
<a name="l00226"></a>00226             }
<a name="l00227"></a>00227             free(root);
<a name="l00228"></a>00228             priv-&gt;<a class="code" href="struct_sync_private.html#a17d91740bea687c5cdb63ec6272a8727">nRoots</a>--;
<a name="l00229"></a>00229             <span class="keywordflow">break</span>;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         lag = <span class="keyword">this</span>;
<a name="l00232"></a>00232         <span class="keyword">this</span> = next;
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234     <span class="keywordflow">return</span> NULL;
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *
<a name="l00238"></a><a class="code" href="_sync_root_8h.html#acd5e0ea632c51a5e079da5b8bcc25763">00238</a> <a class="code" href="_sync_root_8c.html#acd5e0ea632c51a5e079da5b8bcc25763" title="Parse a content object representing a config slice, and if successful add it to the...">SyncRootDecodeAndAdd</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_base_struct.html">SyncBaseStruct</a> *<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a>,
<a name="l00239"></a>00239                      <span class="keyword">struct</span> <a class="code" href="structccn__buf__decoder.html">ccn_buf_decoder</a> *d) {
<a name="l00240"></a>00240     <span class="keyword">struct </span><a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root = NULL;
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (<a class="code" href="ccn_8h.html#a127d4f9a3f901ba15bc5335d5a9fa3b0">ccn_buf_match_dtag</a>(d, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a3f4b94aee2170543a51f93ccad985dfd">CCN_DTAG_SyncConfigSlice</a>)) {
<a name="l00242"></a>00242         <span class="keywordtype">int</span> oops = 0;
<a name="l00243"></a>00243         <a class="code" href="ccn_8h.html#a1b17cadb92b2339cba24721b0466a0ce">ccn_buf_advance</a>(d);
<a name="l00244"></a>00244         uintmax_t vers = <a class="code" href="_sync_util_8c.html#a748feb74d831a6cbec1075024ded26bb">SyncParseUnsigned</a>(d, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a4f736b68912ea01258ea8c85f507e144">CCN_DTAG_SyncVersion</a>);
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (vers == <a class="code" href="sync_8h.html#a492d15c12a9ad1e17e0663c75cb92611">SLICE_VERSION</a>) {
<a name="l00246"></a>00246             <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *topo = <a class="code" href="_sync_util_8c.html#aa637859a381e666813e30b3308718817">SyncExtractName</a>(d);
<a name="l00247"></a>00247             <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *prefix = <a class="code" href="_sync_util_8c.html#aa637859a381e666813e30b3308718817">SyncExtractName</a>(d);
<a name="l00248"></a>00248             <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *filter = <a class="code" href="_sync_util_8c.html#adcdacf16d78ec4fff95eff5f0d63446b">SyncAllocNameAccum</a>(4);
<a name="l00249"></a>00249             <span class="keywordflow">if</span> (<a class="code" href="ccn_8h.html#a127d4f9a3f901ba15bc5335d5a9fa3b0">ccn_buf_match_dtag</a>(d, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a984a080efd736509ec5606027aa6cd78">CCN_DTAG_SyncConfigSliceList</a>)) {
<a name="l00250"></a>00250                 <a class="code" href="ccn_8h.html#a1b17cadb92b2339cba24721b0466a0ce">ccn_buf_advance</a>(d);
<a name="l00251"></a>00251                 <span class="keywordflow">while</span> (<a class="code" href="ccn_8h.html#a127d4f9a3f901ba15bc5335d5a9fa3b0">ccn_buf_match_dtag</a>(d, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33af819040038b78925190e62c02487c2da">CCN_DTAG_SyncConfigSliceOp</a>)) {
<a name="l00252"></a>00252                     uintmax_t op = <a class="code" href="_sync_util_8c.html#a748feb74d831a6cbec1075024ded26bb">SyncParseUnsigned</a>(d, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33af819040038b78925190e62c02487c2da">CCN_DTAG_SyncConfigSliceOp</a>);
<a name="l00253"></a>00253                     <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *clause = <a class="code" href="_sync_util_8c.html#aa637859a381e666813e30b3308718817">SyncExtractName</a>(d);
<a name="l00254"></a>00254                     <span class="keywordflow">if</span> (op != 0 || clause == NULL) {
<a name="l00255"></a>00255                         oops++;
<a name="l00256"></a>00256                         <span class="keywordflow">break</span>;
<a name="l00257"></a>00257                     }
<a name="l00258"></a>00258                     <a class="code" href="_sync_util_8c.html#a9c7204a6cd37470ba61c05e5da8d8fc6" title="appends a new name with associated data important: the name is not copied!">SyncNameAccumAppend</a>(filter, clause, op);
<a name="l00259"></a>00259                 }
<a name="l00260"></a>00260                 <a class="code" href="ccn_8h.html#a1868a32594c3c2a98e60049a3f3184b8" title="Enter an error state if element closer not found.">ccn_buf_check_close</a>(d);
<a name="l00261"></a>00261                 <span class="keywordflow">if</span> (<a class="code" href="_sync_util_8c.html#a85a42d217af026083077adafcc731f0b">SyncCheckDecodeErr</a>(d)) oops++;
<a name="l00262"></a>00262             }
<a name="l00263"></a>00263             <a class="code" href="ccn_8h.html#a1868a32594c3c2a98e60049a3f3184b8" title="Enter an error state if element closer not found.">ccn_buf_check_close</a>(d);
<a name="l00264"></a>00264             <span class="keywordflow">if</span> (<a class="code" href="_sync_util_8c.html#a85a42d217af026083077adafcc731f0b">SyncCheckDecodeErr</a>(d)) oops++;
<a name="l00265"></a>00265             <span class="keywordflow">if</span> (oops == 0) {
<a name="l00266"></a>00266                 <span class="comment">// TBD: extract the scope from the slice</span>
<a name="l00267"></a>00267                 root = <a class="code" href="_sync_root_8c.html#a18308ecffb5585c8bcbd63d20a7e85b5" title="namesToAdd has the names where content is known to be present.">SyncAddRoot</a>(base, base-&gt;<a class="code" href="struct_sync_base_struct.html#ab7d5452e09cb0b6e41205bc9f00e4bf8">priv</a>-&gt;<a class="code" href="struct_sync_private.html#a93954553a69c0f2af33957e185af2bbe">syncScope</a>, topo, prefix, filter);
<a name="l00268"></a>00268             }
<a name="l00269"></a>00269             <span class="comment">// regardless of success, the temporary storage must be returned</span>
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (topo != NULL) <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;topo);
<a name="l00271"></a>00271             <span class="keywordflow">if</span> (prefix != NULL) <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;prefix);
<a name="l00272"></a>00272             <span class="keywordflow">if</span> (filter != NULL) <a class="code" href="_sync_util_8c.html#a6c2c47daae1a00b2fd20577c8bd7eef0" title="frees the name accum and all of the names">SyncFreeNameAccumAndNames</a>(filter);
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     <span class="keywordflow">return</span> root;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00279"></a><a class="code" href="_sync_root_8c.html#aef368e8228e7ec6e3feb64258616ab4d">00279</a> <a class="code" href="_sync_root_8c.html#aef368e8228e7ec6e3feb64258616ab4d">appendName</a>(<span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *cb, <span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *name) {
<a name="l00280"></a>00280     <span class="comment">// we use this to append a name when the name might be NULL</span>
<a name="l00281"></a>00281     <span class="comment">// the slice encoding depends on position</span>
<a name="l00282"></a>00282     <span class="keywordtype">int</span> res = 0;
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (name == NULL) {
<a name="l00284"></a>00284         name = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>();
<a name="l00285"></a>00285         <a class="code" href="ccn_8h.html#a4aa75ce6fc675e7a4c4c6d65e68817bd" title="Reset charbuf to represent an empty Name in binary format.">ccn_name_init</a>(name);
<a name="l00286"></a>00286         res |= <a class="code" href="charbuf_8h.html#aca88638b2e81602eb4a1da9be923dad7">ccn_charbuf_append_charbuf</a>(cb, name);
<a name="l00287"></a>00287         <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;name);
<a name="l00288"></a>00288     } <span class="keywordflow">else</span>
<a name="l00289"></a>00289         res |= <a class="code" href="charbuf_8h.html#aca88638b2e81602eb4a1da9be923dad7">ccn_charbuf_append_charbuf</a>(cb, name);
<a name="l00290"></a>00290     <span class="keywordflow">return</span> res;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00294"></a><a class="code" href="_sync_root_8h.html#a186493a3edabb31639a268e289b45bc5">00294</a> <a class="code" href="_sync_root_8c.html#a120e0cc1725f3c09a2f2d624387038b3" title="Appends the ccnb encoding for a config slice to the provided cb.">SyncRootAppendSlice</a>(<span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *cb, <span class="keyword">struct</span> <a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root) {
<a name="l00295"></a>00295     <span class="keywordtype">int</span> res = 0;
<a name="l00296"></a>00296     res |= <a class="code" href="ccn_8h.html#afc2eb536e63f315968abe901e52b506a" title="Append a start-of-element marker.">ccnb_element_begin</a>(cb, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a3f4b94aee2170543a51f93ccad985dfd">CCN_DTAG_SyncConfigSlice</a>);
<a name="l00297"></a>00297     res |= <a class="code" href="_sync_util_8c.html#a76715b669066c712303384030a36242f">SyncAppendTaggedNumber</a>(cb, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a4f736b68912ea01258ea8c85f507e144">CCN_DTAG_SyncVersion</a>, <a class="code" href="sync_8h.html#a492d15c12a9ad1e17e0663c75cb92611">SLICE_VERSION</a>);
<a name="l00298"></a>00298     <span class="comment">// TBD: encode the scope</span>
<a name="l00299"></a>00299     res |= <a class="code" href="_sync_root_8c.html#aef368e8228e7ec6e3feb64258616ab4d">appendName</a>(cb, root-&gt;<a class="code" href="struct_sync_root_struct.html#a6ba6270127aea47744c6860e6aff6627" title="Sync Protocol topo prefix.">topoPrefix</a>);
<a name="l00300"></a>00300     res |= <a class="code" href="_sync_root_8c.html#aef368e8228e7ec6e3feb64258616ab4d">appendName</a>(cb, root-&gt;<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a>);
<a name="l00301"></a>00301     res |= <a class="code" href="ccn_8h.html#afc2eb536e63f315968abe901e52b506a" title="Append a start-of-element marker.">ccnb_element_begin</a>(cb, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33a984a080efd736509ec5606027aa6cd78">CCN_DTAG_SyncConfigSliceList</a>);
<a name="l00302"></a>00302     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *filter = root-&gt;<a class="code" href="struct_sync_root_struct.html#a24acad680fbad7342bfc4a4c8f9fcf82" title="filter clauses">filter</a>;
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (res &gt;= 0 &amp;&amp; filter != NULL) {
<a name="l00304"></a>00304         <span class="keywordtype">int</span> i = 0;
<a name="l00305"></a>00305         <span class="keywordflow">for</span> (i = 0; i &lt; filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>; i++) {
<a name="l00306"></a>00306             <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *clause = filter-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a>;
<a name="l00307"></a>00307             res |= <a class="code" href="_sync_util_8c.html#a76715b669066c712303384030a36242f">SyncAppendTaggedNumber</a>(cb, <a class="code" href="coding_8h.html#a720ee1182276ef229dcf775366d84f33af819040038b78925190e62c02487c2da">CCN_DTAG_SyncConfigSliceOp</a>, 0);
<a name="l00308"></a>00308             res |= <a class="code" href="charbuf_8h.html#aca88638b2e81602eb4a1da9be923dad7">ccn_charbuf_append_charbuf</a>(cb, clause);
<a name="l00309"></a>00309             <span class="keywordflow">if</span> (res &lt; 0) <span class="keywordflow">break</span>;
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312     res |= <a class="code" href="ccn_8h.html#aa46b72f2e6b3b7f7753ff3baaa4efdf8" title="Append an end-of-element marker.">ccnb_element_end</a>(cb);
<a name="l00313"></a>00313     res |= <a class="code" href="ccn_8h.html#aa46b72f2e6b3b7f7753ff3baaa4efdf8" title="Append an end-of-element marker.">ccnb_element_end</a>(cb);
<a name="l00314"></a>00314     <span class="keywordflow">return</span> res;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *
<a name="l00318"></a><a class="code" href="_sync_root_8h.html#aed2aaaf7ab32c22cf311c996f97e13b8">00318</a> <a class="code" href="_sync_root_8c.html#aed2aaaf7ab32c22cf311c996f97e13b8">SyncRootTopEntry</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root) {
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a013f6ae133c768d7bff2495445283bb4" title="current top-level cache hash">currentHash</a>-&gt;<a class="code" href="structccn__charbuf.html#a8847707f323a0aa35e2a81001a2d1fbf">length</a> &gt; 0) {
<a name="l00320"></a>00320         <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *hash = root-&gt;<a class="code" href="struct_sync_root_struct.html#a013f6ae133c768d7bff2495445283bb4" title="current top-level cache hash">currentHash</a>;
<a name="l00321"></a>00321         <span class="keyword">struct </span><a class="code" href="struct_sync_hash_cache_entry.html">SyncHashCacheEntry</a> *ent = <a class="code" href="_sync_hash_cache_8c.html#a15c6eafb71bb631fde85a2424f5ac449" title="lookup a full hash in a hash table (raw contents, no tag)">SyncHashLookup</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a404384379387e0beb78ebfb7b81109f6" title="cache head">ch</a>,
<a name="l00322"></a>00322                                                         hash-&gt;<a class="code" href="structccn__charbuf.html#af24075ee3911a992d0dda6f449f3b3b3">buf</a>,
<a name="l00323"></a>00323                                                         hash-&gt;<a class="code" href="structccn__charbuf.html#a8847707f323a0aa35e2a81001a2d1fbf">length</a>);
<a name="l00324"></a>00324         <span class="keywordflow">return</span> ent;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">return</span> NULL;
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="keyword">extern</span> <span class="keyword">enum</span> <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06">SyncRootLookupCode</a>
<a name="l00330"></a><a class="code" href="_sync_root_8h.html#a7d7a39b275db66878bc92d605e042f65">00330</a> <a class="code" href="_sync_root_8c.html#a7d7a39b275db66878bc92d605e042f65" title="Tests to see if the name is covered by this root.">SyncRootLookupName</a>(<span class="keyword">struct</span> <a class="code" href="struct_sync_root_struct.html" title="A SyncRootStruct object holds the necessary data for a root sync tree.">SyncRootStruct</a> *root,
<a name="l00331"></a>00331                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *name) {
<a name="l00332"></a>00332     <span class="keywordtype">int</span> skip = 0;
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (name == NULL)
<a name="l00334"></a>00334         <span class="comment">// and why were we called?</span>
<a name="l00335"></a>00335         <span class="keywordflow">return</span> <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06a7950dba5d481171f37ddf0d3512dc637" title="error in the name or the state">SyncRootLookupCode_error</a>;
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (root-&gt;<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a> != NULL) {
<a name="l00337"></a>00337         skip = <a class="code" href="_sync_util_8c.html#a4ccb250b1c02f44a29dfb8bbecd77c38">SyncPrefixMatch</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a>, name, 0);
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (skip &lt; 0) <span class="keywordflow">return</span> <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06a7950dba5d481171f37ddf0d3512dc637" title="error in the name or the state">SyncRootLookupCode_error</a>;
<a name="l00339"></a>00339         <span class="keywordflow">if</span> (skip == 0) <span class="keywordflow">return</span> <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06aae05075f0f725b9e3350582cea010cd8" title="not covered by this root">SyncRootLookupCode_none</a>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     skip = <a class="code" href="_sync_util_8c.html#aa1be3053fdf3e2122f3582e74ff8b694">SyncComponentCount</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#a88e2d2d45da428702e31f7067278a19a" title="Sync Protocol naming prefix.">namingPrefix</a>);
<a name="l00342"></a>00342     <span class="keyword">enum</span> <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06">SyncRootLookupCode</a> res = <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06a2cfb1cd9a212e7bc6f9839c7b35f0ca6" title="covered by this root">SyncRootLookupCode_covered</a>;
<a name="l00343"></a>00343     <span class="keyword">struct </span><a class="code" href="struct_sync_name_accum.html">SyncNameAccum</a> *filter = root-&gt;<a class="code" href="struct_sync_root_struct.html#a24acad680fbad7342bfc4a4c8f9fcf82" title="filter clauses">filter</a>;
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (filter != NULL &amp;&amp; filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a> &gt; 0) {
<a name="l00345"></a>00345         <span class="comment">// if present, there are restrictions, relative to the prefix</span>
<a name="l00346"></a>00346         <span class="keywordtype">int</span> i = 0;
<a name="l00347"></a>00347         res = <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06aae05075f0f725b9e3350582cea010cd8" title="not covered by this root">SyncRootLookupCode_none</a>;
<a name="l00348"></a>00348         <span class="keywordflow">for</span> (i = 0; i &lt; filter-&gt;<a class="code" href="struct_sync_name_accum.html#a43e6bf3321957d08f4985443cc36555d">len</a>; i++) {
<a name="l00349"></a>00349             <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *pat = filter-&gt;<a class="code" href="struct_sync_name_accum.html#af3b404ba438b87e0b363398dd20b4a1f">ents</a>[i].<a class="code" href="struct_sync_name_accum_entry.html#a4cb7dff04e4e2a74edcfc20368ad58b4">name</a>;
<a name="l00350"></a>00350             <span class="keywordtype">int</span> match = <a class="code" href="_sync_util_8c.html#ad17a0cef75b4cd72aeaf932524a4ce31" title="simple pattern matching, where the pattern may contain components with a single 255...">SyncPatternMatch</a>(pat, name, skip);
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (match &lt; 0) {
<a name="l00352"></a>00352                 res = <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06a7950dba5d481171f37ddf0d3512dc637" title="error in the name or the state">SyncRootLookupCode_error</a>;
<a name="l00353"></a>00353                 <span class="keywordflow">break</span>;
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             <span class="keywordflow">if</span> (match &gt; 0) {
<a name="l00356"></a>00356                 res = <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06a2cfb1cd9a212e7bc6f9839c7b35f0ca6" title="covered by this root">SyncRootLookupCode_covered</a>;
<a name="l00357"></a>00357                 <span class="keywordflow">break</span>;
<a name="l00358"></a>00358             }
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360         <span class="keywordflow">if</span> (res == <a class="code" href="_sync_root_8h.html#a0a5eaadf73d65b7f64d364cbcb2bee06aae05075f0f725b9e3350582cea010cd8" title="not covered by this root">SyncRootLookupCode_none</a> &amp;&amp; root-&gt;<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a>-&gt;<a class="code" href="struct_sync_base_struct.html#a700f75c76dde6f2a525ea5b4cf7c0b79">debug</a> &gt; 16) {
<a name="l00361"></a>00361             <span class="keyword">struct </span><a class="code" href="structccn__charbuf.html">ccn_charbuf</a> *uri = <a class="code" href="charbuf_8h.html#a6db2918ed16206ad07920ab26aac9da6">ccn_charbuf_create</a>();
<a name="l00362"></a>00362             <a class="code" href="uri_8h.html#a46512a74f8d78b3e01fbc115f652ae8d" title="This appends to c a URI representation of the ccnb-encoded Name element passed in...">ccn_uri_append</a>(uri, name-&gt;<a class="code" href="structccn__charbuf.html#af24075ee3911a992d0dda6f449f3b3b3">buf</a>, name-&gt;<a class="code" href="structccn__charbuf.html#a8847707f323a0aa35e2a81001a2d1fbf">length</a>, 0);
<a name="l00363"></a>00363             <span class="keywordtype">char</span> *str = <a class="code" href="charbuf_8h.html#a36e1d775f3526c0b1f0bae4f3734b5ec">ccn_charbuf_as_string</a>(uri);
<a name="l00364"></a>00364             <a class="code" href="_sync_base_8c.html#a126bf64c323813fa9a759b0f8c7d6ec1">sync_msg</a>(root-&gt;<a class="code" href="struct_sync_root_struct.html#aeb13995531505b4198ee20697bf1c08f" title="Sync Agent base.">base</a>, <span class="stringliteral">&quot;SyncRootLookupName, rejected %s&quot;</span>, str);
<a name="l00365"></a>00365             <a class="code" href="charbuf_8h.html#a699030e7cb3c51ca2cde46af0ba6e1bb">ccn_charbuf_destroy</a>(&amp;uri);
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368     <span class="keywordflow">return</span> res;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Feb 4 11:56:49 2013 for Content-Centric Networking in C by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
